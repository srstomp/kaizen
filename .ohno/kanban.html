<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ohno - Kanban Board</title>
    <script>window.KANBAN_DATA = {"synced_at":"2026-01-30T00:47:12.996Z","version":"0.12.0","projects":[],"epics":[{"id":"epic-c094d920","project_id":null,"title":"Kaizen Core - Failure Capture System","description":"Build the core kaizen feedback loop functionality including commands for capturing failures, detecting categories, suggesting fixes, and SQLite storage for pattern learning. This is the foundation for the integrated quality system.\n\nKey capabilities:\n- `kaizen capture` - capture failure from reviewer output\n- `kaizen detect-category` - auto-detect failure category from details\n- `kaizen suggest` - suggest fix task based on confidence scoring\n- `kaizen init --bootstrap` - initialize with bootstrap data\n- SQLite storage for global + project-local failures\n- Fix task templates per category","priority":"P0","status":"todo","created_at":"2026-01-29T19:27:43.368Z","updated_at":"2026-01-29T19:27:43.368Z"},{"id":"epic-595024e6","project_id":null,"title":"Pokayokay Integration","description":"Integrate kaizen with pokayokay through the post-review-fail hook. Enable graceful degradation when kaizen is not installed.\n\nKey capabilities:\n- `post-review-fail` hook calling kaizen commands\n- Modified work.md flow to handle hook output\n- Graceful degradation when kaizen not installed\n- Documentation updates (GUIDE.md, integrations/kaizen.md)","priority":"P1","status":"todo","created_at":"2026-01-29T19:27:43.507Z","updated_at":"2026-01-29T19:27:43.507Z"},{"id":"epic-c0a411b6","project_id":null,"title":"Ohno Enhancement - Source Tracking","description":"Add source field to ohno task schema to track task origin (human, pokayokay-plan, kaizen-fix, kaizen-suggest).\n\nKey capabilities:\n- `source` field in task schema\n- `--source` CLI flag for task creation\n- Optional: `ohno stats --by-source`","priority":"P1","status":"todo","created_at":"2026-01-29T19:27:43.618Z","updated_at":"2026-01-29T19:27:43.618Z"},{"id":"epic-6a9ad408","project_id":null,"title":"Cross-Repo Documentation","description":"Create and link documentation across kaizen, pokayokay, and ohno repositories for the integrated quality system.\n\nKey capabilities:\n- Link kaizen → pokayokay/ohno integration docs\n- Link pokayokay → kaizen for quality metrics\n- Link ohno → kaizen for auto-created task tracking\n- Consistent terminology across repos","priority":"P2","status":"todo","created_at":"2026-01-29T19:27:43.738Z","updated_at":"2026-01-29T19:27:43.738Z"}],"stories":[{"id":"story-22706cb8","epic_id":"epic-c094d920","title":"SQLite Failure Storage","description":"Implement SQLite-based storage for failure patterns with both global (~/.config/kaizen/) and project-local (.kaizen/) storage.\n\nAcceptance criteria:\n- Global DB at ~/.config/kaizen/failures.db captures patterns across all projects\n- Project-local overrides at .kaizen/overrides.yaml take precedence\n- Bootstrap from existing failures/ directory on first run\n- Support for occurrence counting and confidence scoring","status":"todo","created_at":"2026-01-29T19:30:55.975Z","updated_at":"2026-01-29T19:30:55.975Z"},{"id":"story-10fcd7e0","epic_id":"epic-c094d920","title":"Capture Command","description":"Implement `kaizen capture` command to capture failures from reviewer output.\n\nUsage:\n```bash\nkaizen capture \\\n  --task-id \"TASK-123\" \\\n  --category \"missing-tests\" \\\n  --details \"Missing tests for auth.go, token.go\" \\\n  --source \"yokay-quality-reviewer\"\n```\n\nAcceptance criteria:\n- Accepts task-id, category, details, source flags\n- Stores failure in SQLite database\n- Increments occurrence count for category\n- Returns success/failure status","status":"todo","created_at":"2026-01-29T19:30:56.206Z","updated_at":"2026-01-29T19:30:56.206Z"},{"id":"story-dc0f7348","epic_id":"epic-c094d920","title":"Detect Category Command","description":"Implement `kaizen detect-category` command to auto-detect failure category from details.\n\nUsage:\n```bash\nkaizen detect-category --details \"Missing tests for auth.go\"\n# Output: missing-tests\n```\n\nAcceptance criteria:\n- Pattern matching against known categories\n- Returns category name or \"unknown\"\n- Supports categories: missing-tests, scope-creep, wrong-product, etc.","status":"todo","created_at":"2026-01-29T19:30:56.369Z","updated_at":"2026-01-29T19:30:56.369Z"},{"id":"story-44579502","epic_id":"epic-c094d920","title":"Suggest Command","description":"Implement `kaizen suggest` command to suggest fix task based on confidence scoring.\n\nUsage:\n```bash\nkaizen suggest --task-id \"TASK-123\" --category \"missing-tests\"\n```\n\nOutput:\n```json\n{\n  \"category\": \"missing-tests\",\n  \"occurrences\": 7,\n  \"confidence\": \"high\",\n  \"action\": \"auto-create\",\n  \"fix_task\": {\n    \"title\": \"Fix: Add tests for TASK-123\",\n    \"type\": \"bug\",\n    \"description\": \"Quality review failed: missing tests...\",\n    \"blocks\": \"TASK-123\"\n  }\n}\n```\n\nConfidence thresholds:\n- 5+ occurrences → high → auto-create\n- 2-4 occurrences → medium → suggest\n- 1 occurrence → low → log-only\n\nAcceptance criteria:\n- Queries occurrence count from storage\n- Applies confidence thresholds\n- Returns JSON with action recommendation\n- Generates fix task details from templates","status":"todo","created_at":"2026-01-29T19:30:56.525Z","updated_at":"2026-01-29T19:30:56.525Z"},{"id":"story-a728e24f","epic_id":"epic-c094d920","title":"Fix Task Templates","description":"Implement YAML-based fix task templates for each failure category.\n\nLocation: failures/templates/\n- missing-tests.yaml\n- scope-creep.yaml\n- wrong-product.yaml\n- etc.\n\nTemplate format:\n```yaml\ncategory: missing-tests\nprefix: WT\nfix_task:\n  title_template: \"Fix: Add tests for {original_task_id}\"\n  type: bug\n  description_template: |\n    Quality review failed on {original_task_id}.\n    Issue: Missing test coverage\n    Files: {files}\n    ...\n  estimate_hours: 1\n```\n\nAcceptance criteria:\n- YAML template parsing\n- Variable substitution in templates\n- Fallback to default template for unknown categories","status":"todo","created_at":"2026-01-29T19:30:56.675Z","updated_at":"2026-01-29T19:30:56.675Z"},{"id":"story-8d104f4b","epic_id":"epic-c094d920","title":"Init Command with Bootstrap","description":"Implement `kaizen init --bootstrap` command to initialize with bootstrap data.\n\nUsage:\n```bash\nkaizen init --bootstrap\n```\n\nAcceptance criteria:\n- Creates ~/.config/kaizen/ directory structure\n- Creates failures.db with schema\n- Bootstraps with existing failures/ directory patterns\n- Safe to run multiple times (idempotent)","status":"todo","created_at":"2026-01-29T19:30:56.816Z","updated_at":"2026-01-29T19:30:56.816Z"},{"id":"story-301d92fb","epic_id":"epic-595024e6","title":"Post-Review-Fail Hook","description":"Implement post-review-fail hook in pokayokay that calls kaizen commands.\n\nHook flow:\n1. Check if kaizen is available\n2. Detect category from failure details\n3. Capture the failure\n4. Get recommendation (auto-create/suggest/log-only)\n5. Handle each action appropriately\n\nAcceptance criteria:\n- Shell script at hooks/post-review-fail.sh\n- Graceful exit if kaizen not installed\n- Calls kaizen detect-category, capture, suggest\n- Handles AUTO/SUGGEST/LOGGED outputs","status":"todo","created_at":"2026-01-29T19:31:20.662Z","updated_at":"2026-01-29T19:31:20.662Z"},{"id":"story-23b230ef","epic_id":"epic-595024e6","title":"Work.md Flow Modification","description":"Modify pokayokay work.md skill to handle post-review-fail hook output.\n\nAfter review fails:\n1. Call post-review-fail hook\n2. Check hook output:\n   - AUTO: Created fix task → Mark current task blocked, get next task\n   - SUGGEST: → Ask user to confirm fix task creation\n   - LOGGED: → Continue with re-dispatch (max 3 attempts)\n\nAcceptance criteria:\n- Hook integration in work.md\n- Proper handling of all three action types\n- Maintains existing re-dispatch behavior for LOGGED","status":"todo","created_at":"2026-01-29T19:31:20.857Z","updated_at":"2026-01-29T19:31:20.857Z"},{"id":"story-ec98cb4e","epic_id":"epic-595024e6","title":"Pokayokay Integration Documentation","description":"Document kaizen integration in pokayokay.\n\nDeliverables:\n- Update GUIDE.md with kaizen integration section\n- Create docs/integrations/kaizen.md explaining setup\n- Installation instructions\n- Configuration options\n\nAcceptance criteria:\n- Clear setup instructions\n- Example workflows\n- Troubleshooting section","status":"todo","created_at":"2026-01-29T19:31:21.011Z","updated_at":"2026-01-29T19:31:21.011Z"},{"id":"story-f15c1805","epic_id":"epic-c0a411b6","title":"Task Source Field","description":"Add source field to ohno task schema.\n\nTaskSource types:\n- \"human\" - Manually created\n- \"pokayokay-plan\" - From /plan command\n- \"kaizen-fix\" - Auto-created by kaizen\n- \"kaizen-suggest\" - Suggested by kaizen, human approved\n\nAcceptance criteria:\n- Schema migration adding source field\n- Default to \"human\" for existing tasks\n- Type validation","status":"todo","created_at":"2026-01-29T19:31:21.164Z","updated_at":"2026-01-29T19:31:21.164Z"},{"id":"story-86153cc4","epic_id":"epic-c0a411b6","title":"Source CLI Flag","description":"Add --source flag to ohno create command.\n\nUsage:\n```bash\nohno create \"Fix: Add tests\" \\\n  --type bug \\\n  --blocks TASK-123 \\\n  --source kaizen-fix\n```\n\nAcceptance criteria:\n- --source flag on create command\n- Validates against allowed source types\n- Stores in database","status":"todo","created_at":"2026-01-29T19:31:21.307Z","updated_at":"2026-01-29T19:31:21.307Z"},{"id":"story-a400e50e","epic_id":"epic-c0a411b6","title":"Ohno Documentation Updates","description":"Update ohno documentation for source field and kaizen integration.\n\nDeliverables:\n- Update README with source field documentation\n- Update ARCHITECTURE.md with kaizen integration flow\n\nAcceptance criteria:\n- Clear documentation of source field\n- Integration flow diagram\n- CLI usage examples","status":"todo","created_at":"2026-01-29T19:31:21.454Z","updated_at":"2026-01-29T19:31:21.454Z"},{"id":"story-d4ffd5cd","epic_id":"epic-6a9ad408","title":"Cross-Repo Documentation Links","description":"Create and link documentation across all three repositories.\n\nDeliverables:\n- Kaizen: Link to pokayokay/ohno integration docs\n- Pokayokay: Link to kaizen for quality metrics\n- Ohno: Link to kaizen for auto-created task tracking\n- Consistent terminology across repos\n\nAcceptance criteria:\n- All cross-references working\n- Terminology consistency check\n- Integration overview in each repo","status":"todo","created_at":"2026-01-29T19:31:21.597Z","updated_at":"2026-01-29T19:31:21.597Z"}],"tasks":[{"id":"task-a0d9e8f3","story_id":"story-ec98cb4e","title":"Create docs/integrations/kaizen.md","status":"in_progress","task_type":"chore","estimate_hours":2,"description":"Create detailed kaizen integration documentation.\n\nContent:\n- Prerequisites\n- Installation steps\n- Configuration options\n- Example workflows\n- Troubleshooting\n\nSkill hint: documentation","context_summary":null,"working_files":null,"blockers":null,"handoff_notes":null,"progress_percent":0,"actual_hours":null,"created_at":"2026-01-29T19:33:00.113Z","updated_at":"2026-01-30T00:47:11.556Z","created_by":null,"activity_summary":null,"story_title":"Pokayokay Integration Documentation","epic_id":"epic-595024e6","epic_title":"Pokayokay Integration","epic_priority":"P1"},{"id":"task-b47f03bd","story_id":"story-301d92fb","title":"Create post-review-fail.sh hook script","status":"done","task_type":"feature","estimate_hours":3,"description":"Create shell script hook for post-review-fail in pokayokay.\n\nScript flow:\n1. Check if kaizen command exists\n2. Detect category: kaizen detect-category --details \"$FAILURE_DETAILS\"\n3. Capture failure: kaizen capture --task-id --category --details --source\n4. Get suggestion: kaizen suggest --task-id --category\n5. Handle action (auto-create/suggest/log-only)\n\nLocation: pokayokay/hooks/post-review-fail.sh\n\nSkill hint: ci-cd-expert","context_summary":null,"working_files":null,"blockers":null,"handoff_notes":"post-review-fail.sh hook integrates pokayokay with kaizen. Graceful error handling, valid JSON output. 6 tests. Commits: 18d5715, 0d40bf2","progress_percent":0,"actual_hours":null,"created_at":"2026-01-29T19:32:59.227Z","updated_at":"2026-01-30T00:46:51.927Z","created_by":null,"activity_summary":null,"story_title":"Post-Review-Fail Hook","epic_id":"epic-595024e6","epic_title":"Pokayokay Integration","epic_priority":"P1"},{"id":"task-572a04d3","story_id":"story-301d92fb","title":"Implement ohno task creation from hook","status":"done","task_type":"feature","estimate_hours":2,"description":"Implement ohno CLI wrapper in kaizen for creating fix tasks.\n\nWrapper calls:\nohno create \"$TITLE\" \\\n  --type bug \\\n  --blocks \"$TASK_ID\" \\\n  --description \"$DESC\" \\\n  --source kaizen-fix\n\nLocation: internal/integration/ohno.go\n\nSkill hint: api-integration","context_summary":null,"working_files":null,"blockers":null,"handoff_notes":"OhnoClient wrapper for fix task creation. Builds CLI args, parses task ID, handles errors. 9 tests. Commits: 12051c6, 3b809ab","progress_percent":0,"actual_hours":null,"created_at":"2026-01-29T19:32:59.433Z","updated_at":"2026-01-30T00:34:44.717Z","created_by":null,"activity_summary":null,"story_title":"Post-Review-Fail Hook","epic_id":"epic-595024e6","epic_title":"Pokayokay Integration","epic_priority":"P1"},{"id":"task-a8df1d51","story_id":"story-a400e50e","title":"Update ohno README with source field docs","status":"done","task_type":"chore","estimate_hours":1,"description":"Update ohno README with source field documentation.\n\nContent:\n- Source field description\n- CLI usage examples\n- Integration with kaizen\n\nSkill hint: documentation","context_summary":null,"working_files":null,"blockers":null,"handoff_notes":"README updated with source field docs: 4 source types, CLI/MCP examples, kaizen integration mention. Commits: 9c061ba, 6fe7e97","progress_percent":0,"actual_hours":null,"created_at":"2026-01-29T19:33:00.654Z","updated_at":"2026-01-30T00:26:03.892Z","created_by":null,"activity_summary":null,"story_title":"Ohno Documentation Updates","epic_id":"epic-c0a411b6","epic_title":"Ohno Enhancement - Source Tracking","epic_priority":"P1"},{"id":"task-0ac853b3","story_id":"story-86153cc4","title":"Add --source flag to ohno create command","status":"done","task_type":"feature","estimate_hours":2,"description":"Add --source CLI flag to ohno create command.\n\nUsage:\nohno create \"Fix task\" --source kaizen-fix\n\nValidates against allowed source types.\n\nSkill hint: api-design","context_summary":null,"working_files":null,"blockers":null,"handoff_notes":"--source flag added to ohno create. Validates against 4 types, defaults to \"human\". 5 tests. Commit: 106c849","progress_percent":0,"actual_hours":null,"created_at":"2026-01-29T19:33:00.411Z","updated_at":"2026-01-30T00:17:37.568Z","created_by":null,"activity_summary":null,"story_title":"Source CLI Flag","epic_id":"epic-c0a411b6","epic_title":"Ohno Enhancement - Source Tracking","epic_priority":"P1"},{"id":"task-fb3ba58f","story_id":"story-f15c1805","title":"Write tests for source field","status":"done","task_type":"test","estimate_hours":2,"description":"Write tests for source field functionality.\n\nTest cases:\n- Default source is \"human\"\n- --source flag sets value\n- Invalid source type rejected\n- Migration preserves existing tasks\n\nSkill hint: testing-strategy","context_summary":null,"working_files":null,"blockers":null,"handoff_notes":"Already implemented via TDD in task-e9d6123a. All 4 test cases covered: default human, source flag, invalid rejection, migration.","progress_percent":0,"actual_hours":null,"created_at":"2026-01-29T19:33:00.531Z","updated_at":"2026-01-30T00:08:53.123Z","created_by":null,"activity_summary":null,"story_title":"Task Source Field","epic_id":"epic-c0a411b6","epic_title":"Ohno Enhancement - Source Tracking","epic_priority":"P1"},{"id":"task-e9d6123a","story_id":"story-f15c1805","title":"Add source field to ohno task schema","status":"done","task_type":"feature","estimate_hours":2,"description":"Add source field to task interface and schema.\n\nTaskSource types:\n- \"human\" (default)\n- \"pokayokay-plan\"\n- \"kaizen-fix\"\n- \"kaizen-suggest\"\n\nIncludes schema migration for existing tasks.\n\nSkill hint: database-design","context_summary":null,"working_files":null,"blockers":null,"handoff_notes":"TaskSource type added to ohno-core with schema migration. MCP create_task tool updated. 12 new tests. Commit: 5e7a3eb","progress_percent":0,"actual_hours":null,"created_at":"2026-01-29T19:33:00.251Z","updated_at":"2026-01-30T00:08:02.291Z","created_by":null,"activity_summary":null,"story_title":"Task Source Field","epic_id":"epic-c0a411b6","epic_title":"Ohno Enhancement - Source Tracking","epic_priority":"P1"},{"id":"task-e418042a","story_id":"story-22706cb8","title":"Implement global vs project-local storage resolution","status":"done","task_type":"feature","estimate_hours":2,"description":"Implement storage resolution logic.\n\nPaths:\n- Global: ~/.config/kaizen/failures.db\n- Project: .kaizen/overrides.yaml, .kaizen/local-failures.db\n\nLogic:\n- Project-local overrides take precedence\n- Global DB captures patterns across all projects\n- Merge results when querying\n\nLocation: internal/failures/store.go\n\nSkill hint: database-design","context_summary":null,"working_files":null,"blockers":null,"handoff_notes":"StorageResolver with project-local vs global path resolution, walks up directory tree","progress_percent":0,"actual_hours":null,"created_at":"2026-01-29T19:31:40.277Z","updated_at":"2026-01-29T23:47:17.340Z","created_by":null,"activity_summary":null,"story_title":"SQLite Failure Storage","epic_id":"epic-c094d920","epic_title":"Kaizen Core - Failure Capture System","epic_priority":"P0"},{"id":"task-73abaea4","story_id":"story-22706cb8","title":"Write tests for failure store","status":"done","task_type":"test","estimate_hours":2,"description":"Write comprehensive tests for failure store.\n\nTest cases:\n- Insert and retrieve failure\n- Increment occurrence count\n- Global vs project-local resolution\n- Edge cases (empty DB, unknown category)\n\nLocation: internal/failures/store_test.go\n\nSkill hint: testing-strategy","context_summary":null,"working_files":null,"blockers":null,"handoff_notes":"24 test functions already exist covering all required cases","progress_percent":0,"actual_hours":null,"created_at":"2026-01-29T19:31:40.423Z","updated_at":"2026-01-29T23:44:23.797Z","created_by":null,"activity_summary":null,"story_title":"SQLite Failure Storage","epic_id":"epic-c094d920","epic_title":"Kaizen Core - Failure Capture System","epic_priority":"P0"},{"id":"task-49403290","story_id":"story-10fcd7e0","title":"Write tests for capture command","status":"done","task_type":"test","estimate_hours":2,"description":"Write tests for capture command.\n\nTest cases:\n- Valid capture stores failure\n- Missing required flags error\n- Invalid category handling\n- JSON output format\n\nLocation: cmd/kaizen/capture_test.go\n\nSkill hint: testing-strategy","context_summary":null,"working_files":null,"blockers":null,"handoff_notes":"Tests already exist from previous task - 4 test functions covering all required cases","progress_percent":0,"actual_hours":null,"created_at":"2026-01-29T19:32:02.640Z","updated_at":"2026-01-29T23:41:43.080Z","created_by":null,"activity_summary":null,"story_title":"Capture Command","epic_id":"epic-c094d920","epic_title":"Kaizen Core - Failure Capture System","epic_priority":"P0"},{"id":"task-c435046d","story_id":"story-10fcd7e0","title":"Implement capture command CLI","status":"done","task_type":"feature","estimate_hours":3,"description":"Implement `kaizen capture` CLI command.\n\nFlags:\n- --task-id (required)\n- --category (required)\n- --details (required)\n- --source (required)\n\nBehavior:\n- Validate inputs\n- Store failure in DB\n- Increment category occurrence count\n- Return success/failure JSON\n\nLocation: cmd/kaizen/capture.go\n\nSkill hint: api-design","context_summary":null,"working_files":null,"blockers":null,"handoff_notes":"kaizen capture --task-id --category --details --source stores failure and increments count","progress_percent":0,"actual_hours":null,"created_at":"2026-01-29T19:32:02.485Z","updated_at":"2026-01-29T23:41:03.079Z","created_by":null,"activity_summary":null,"story_title":"Capture Command","epic_id":"epic-c094d920","epic_title":"Kaizen Core - Failure Capture System","epic_priority":"P0"},{"id":"task-0d6a0ac8","story_id":"story-dc0f7348","title":"Write tests for detect-category","status":"done","task_type":"test","estimate_hours":2,"description":"Write tests for detect-category command.\n\nTest cases:\n- Each known category detection\n- Unknown details return \"unknown\"\n- Case insensitive matching\n- Multiple keyword matches\n\nLocation: cmd/kaizen/detect_test.go, internal/failures/patterns_test.go\n\nSkill hint: testing-strategy","context_summary":null,"working_files":null,"blockers":null,"handoff_notes":"Tests already exist from previous tasks - 5 test functions with 26+ test cases total","progress_percent":0,"actual_hours":null,"created_at":"2026-01-29T19:32:03.056Z","updated_at":"2026-01-29T23:29:51.385Z","created_by":null,"activity_summary":null,"story_title":"Detect Category Command","epic_id":"epic-c094d920","epic_title":"Kaizen Core - Failure Capture System","epic_priority":"P0"},{"id":"task-562fa218","story_id":"story-dc0f7348","title":"Implement detect-category command CLI","status":"done","task_type":"feature","estimate_hours":2,"description":"Implement `kaizen detect-category` CLI command.\n\nFlags:\n- --details (required)\n\nBehavior:\n- Run pattern matching on details\n- Return detected category or \"unknown\"\n\nLocation: cmd/kaizen/detect.go\n\nSkill hint: api-design","context_summary":null,"working_files":null,"blockers":null,"handoff_notes":"kaizen detect-category --details returns JSON with detected_category, all_categories, matched fields","progress_percent":0,"actual_hours":null,"created_at":"2026-01-29T19:32:02.910Z","updated_at":"2026-01-29T23:29:06.903Z","created_by":null,"activity_summary":null,"story_title":"Detect Category Command","epic_id":"epic-c094d920","epic_title":"Kaizen Core - Failure Capture System","epic_priority":"P0"},{"id":"task-d018356d","story_id":"story-dc0f7348","title":"Implement pattern matching for category detection","status":"done","task_type":"feature","estimate_hours":3,"description":"Implement pattern matching logic for auto-detecting failure categories.\n\nCategories to detect:\n- missing-tests: \"missing test\", \"no test\", \"untested\"\n- scope-creep: \"out of scope\", \"not in spec\", \"extra feature\"\n- wrong-product: \"wrong file\", \"incorrect implementation\"\n\nLocation: internal/failures/patterns.go\n\nSkill hint: api-design","context_summary":null,"working_files":null,"blockers":null,"handoff_notes":"Pattern matching for missing-tests, scope-creep, wrong-product categories with case-insensitive detection","progress_percent":0,"actual_hours":null,"created_at":"2026-01-29T19:32:02.774Z","updated_at":"2026-01-29T23:13:19.941Z","created_by":null,"activity_summary":null,"story_title":"Detect Category Command","epic_id":"epic-c094d920","epic_title":"Kaizen Core - Failure Capture System","epic_priority":"P0"},{"id":"task-edca3922","story_id":"story-44579502","title":"Write tests for suggest command","status":"done","task_type":"test","estimate_hours":2,"description":"Write tests for suggest command.\n\nTest cases:\n- High confidence returns auto-create\n- Medium confidence returns suggest\n- Low confidence returns log-only\n- Fix task JSON structure\n\nLocation: cmd/kaizen/suggest_test.go\n\nSkill hint: testing-strategy","context_summary":null,"working_files":null,"blockers":null,"handoff_notes":"Tests complete: high→auto-create, medium→suggest, low→log-only, missing template→null fix_task, missing db→error","progress_percent":0,"actual_hours":null,"created_at":"2026-01-29T19:32:03.478Z","updated_at":"2026-01-29T23:07:36.167Z","created_by":null,"activity_summary":null,"story_title":"Suggest Command","epic_id":"epic-c094d920","epic_title":"Kaizen Core - Failure Capture System","epic_priority":"P0"},{"id":"task-82fa8df8","story_id":"story-44579502","title":"Implement suggest command CLI","status":"done","task_type":"feature","estimate_hours":3,"description":"Implement `kaizen suggest` CLI command.\n\nFlags:\n- --task-id (required)\n- --category (required)\n\nOutput JSON:\n{\n  \"category\": \"missing-tests\",\n  \"occurrences\": 7,\n  \"confidence\": \"high\",\n  \"action\": \"auto-create\",\n  \"fix_task\": { ... }\n}\n\nLocation: cmd/kaizen/suggest.go\n\nSkill hint: api-design","context_summary":null,"working_files":null,"blockers":null,"handoff_notes":"Implemented kaizen suggest --task-id --category with JSON output, confidence scoring, and template rendering","progress_percent":0,"actual_hours":null,"created_at":"2026-01-29T19:32:03.347Z","updated_at":"2026-01-29T23:06:19.174Z","created_by":null,"activity_summary":null,"story_title":"Suggest Command","epic_id":"epic-c094d920","epic_title":"Kaizen Core - Failure Capture System","epic_priority":"P0"},{"id":"task-0478bf44","story_id":"story-44579502","title":"Implement confidence scoring logic","status":"done","task_type":"feature","estimate_hours":2,"description":"Implement confidence scoring based on occurrence count.\n\nThresholds:\n- 5+ occurrences → high → auto-create\n- 2-4 occurrences → medium → suggest\n- 1 occurrence → low → log-only\n\nLocation: internal/failures/patterns.go\n\nSkill hint: api-design","context_summary":null,"working_files":null,"blockers":null,"handoff_notes":"Implemented confidence scoring with thresholds: 5+→high/auto-create, 2-4→medium/suggest, 0-1→low/log-only","progress_percent":0,"actual_hours":null,"created_at":"2026-01-29T19:32:03.197Z","updated_at":"2026-01-29T22:49:22.760Z","created_by":null,"activity_summary":null,"story_title":"Suggest Command","epic_id":"epic-c094d920","epic_title":"Kaizen Core - Failure Capture System","epic_priority":"P0"},{"id":"task-1cddadec","story_id":"story-a728e24f","title":"Write tests for template system","status":"done","task_type":"test","estimate_hours":2,"description":"Write tests for template parsing and substitution.\n\nTest cases:\n- Load template from YAML\n- Variable substitution\n- Unknown category fallback\n- Missing variable handling\n\nLocation: internal/failures/templates_test.go\n\nSkill hint: testing-strategy","context_summary":null,"working_files":null,"blockers":null,"handoff_notes":"Already implemented in task-15170e38. All test cases covered: TestLoadTemplate (with error case), TestLoadAllTemplates, TestRenderTitle (with missing var case), TestRenderDescription.","progress_percent":0,"actual_hours":null,"created_at":"2026-01-29T19:32:25.081Z","updated_at":"2026-01-29T22:39:46.192Z","created_by":null,"activity_summary":null,"story_title":"Fix Task Templates","epic_id":"epic-c094d920","epic_title":"Kaizen Core - Failure Capture System","epic_priority":"P0"},{"id":"task-59fb692b","story_id":"story-a728e24f","title":"Implement template variable substitution","status":"done","task_type":"feature","estimate_hours":2,"description":"Implement variable substitution in templates.\n\nVariables:\n- {original_task_id}\n- {files}\n- {category}\n- {details}\n\nLocation: internal/failures/templates.go\n\nSkill hint: api-design","context_summary":null,"working_files":null,"blockers":null,"handoff_notes":"Already implemented in task-15170e38. RenderTitle and RenderDescription methods in templates.go handle variable substitution via vars map.","progress_percent":0,"actual_hours":null,"created_at":"2026-01-29T19:32:24.946Z","updated_at":"2026-01-29T22:39:08.377Z","created_by":null,"activity_summary":null,"story_title":"Fix Task Templates","epic_id":"epic-c094d920","epic_title":"Kaizen Core - Failure Capture System","epic_priority":"P0"},{"id":"task-15170e38","story_id":"story-a728e24f","title":"Create YAML template structure and parser","status":"done","task_type":"feature","estimate_hours":3,"description":"Create YAML template structure and parser for fix tasks.\n\nTemplate format:\n```yaml\ncategory: missing-tests\nprefix: WT\nfix_task:\n  title_template: \"Fix: Add tests for {original_task_id}\"\n  type: bug\n  description_template: |\n    Quality review failed...\n  estimate_hours: 1\n```\n\nLocation: internal/failures/templates.go\n\nSkill hint: api-design","context_summary":null,"working_files":null,"blockers":null,"handoff_notes":"Template parser complete with TemplateLoader type, loading functions, and variable rendering.","progress_percent":0,"actual_hours":null,"created_at":"2026-01-29T19:32:24.615Z","updated_at":"2026-01-29T22:38:38.415Z","created_by":null,"activity_summary":null,"story_title":"Fix Task Templates","epic_id":"epic-c094d920","epic_title":"Kaizen Core - Failure Capture System","epic_priority":"P0"},{"id":"task-17b150ce","story_id":"story-a728e24f","title":"Create initial fix task templates","status":"done","task_type":"feature","estimate_hours":2,"description":"Create YAML templates for known failure categories.\n\nTemplates to create:\n- failures/templates/missing-tests.yaml\n- failures/templates/scope-creep.yaml\n- failures/templates/wrong-product.yaml\n\nLocation: failures/templates/\n\nSkill hint: documentation","context_summary":null,"working_files":null,"blockers":null,"handoff_notes":"Created missing-tests.yaml, scope-creep.yaml, wrong-product.yaml templates with comprehensive tests.","progress_percent":0,"actual_hours":null,"created_at":"2026-01-29T19:32:24.788Z","updated_at":"2026-01-29T22:29:46.893Z","created_by":null,"activity_summary":null,"story_title":"Fix Task Templates","epic_id":"epic-c094d920","epic_title":"Kaizen Core - Failure Capture System","epic_priority":"P0"},{"id":"task-0f1f0a36","story_id":"story-22706cb8","title":"Implement failure store CRUD operations","status":"done","task_type":"feature","estimate_hours":3,"description":"Implement CRUD operations for failure storage.\n\nMethods:\n- Store.Insert(failure) error\n- Store.GetByCategory(category) ([]Failure, error)\n- Store.GetOccurrenceCount(category) (int, error)\n- Store.IncrementCount(category) error\n\nLocation: internal/failures/store.go\n\nSkill hint: database-design","context_summary":null,"working_files":null,"blockers":null,"handoff_notes":"Implemented Failure struct and 4 CRUD methods: Insert, GetByCategory, GetOccurrenceCount, IncrementCount. All tests passing.","progress_percent":0,"actual_hours":null,"created_at":"2026-01-29T19:31:40.138Z","updated_at":"2026-01-29T22:17:21.340Z","created_by":null,"activity_summary":"[2026-01-29] created: Task created: Implement failure store CRUD operations\n[2026-01-29] note: Handoff notes updated\n[2026-01-29] status_change: Status changed from todo to in_progress\n[2026-01-29] note: Spec review: PASS. Quality review: PASS. All 4 CRUD methods implemented with comprehensive tests (81.2% coverage). Commit: cd4d00fecc26e82b7a9a6c45c9534dbd3d69f964\n[2026-01-29] status_change: Status changed from in_progress to done","story_title":"SQLite Failure Storage","epic_id":"epic-c094d920","epic_title":"Kaizen Core - Failure Capture System","epic_priority":"P0"},{"id":"task-70df5f5e","story_id":"story-8d104f4b","title":"Write tests for init command","status":"done","task_type":"test","estimate_hours":2,"description":"Write tests for init command.\n\nTest cases:\n- Fresh init creates all directories\n- Re-running init is idempotent\n- Bootstrap populates stats\n- Invalid failures directory handling\n\nLocation: cmd/kaizen/init_test.go\n\nSkill hint: testing-strategy","context_summary":null,"working_files":null,"blockers":null,"handoff_notes":"Tests already written via TDD during init command implementation. 11 tests covering: fresh init, idempotency, bootstrap stats, error handling.","progress_percent":0,"actual_hours":null,"created_at":"2026-01-29T19:32:25.525Z","updated_at":"2026-01-29T22:05:57.499Z","created_by":null,"activity_summary":null,"story_title":"Init Command with Bootstrap","epic_id":"epic-c094d920","epic_title":"Kaizen Core - Failure Capture System","epic_priority":"P0"},{"id":"task-419566a4","story_id":"story-8d104f4b","title":"Implement bootstrap from existing failures directory","status":"done","task_type":"feature","estimate_hours":3,"description":"Implement --bootstrap flag for init command.\n\nBehavior:\n- Scan existing failures/ directory\n- Parse failure case files\n- Populate category_stats table\n- Report bootstrap results\n\nLocation: cmd/kaizen/init.go\n\nSkill hint: api-design","context_summary":null,"working_files":null,"blockers":null,"handoff_notes":"Bootstrap flag implemented. Scans failures/, parses YAML, populates category_stats. 9 tests passing. Committed: 7b9fbe5d","progress_percent":0,"actual_hours":null,"created_at":"2026-01-29T19:32:25.374Z","updated_at":"2026-01-29T22:05:20.767Z","created_by":null,"activity_summary":null,"story_title":"Init Command with Bootstrap","epic_id":"epic-c094d920","epic_title":"Kaizen Core - Failure Capture System","epic_priority":"P0"},{"id":"task-5932d9a0","story_id":"story-8d104f4b","title":"Implement init command with directory setup","status":"done","task_type":"feature","estimate_hours":2,"description":"Implement `kaizen init` command.\n\nBehavior:\n- Create ~/.config/kaizen/ directory\n- Create failures.db with schema\n- Create config.yaml with defaults\n- Idempotent (safe to run multiple times)\n\nLocation: cmd/kaizen/init.go\n\nSkill hint: api-design","context_summary":null,"working_files":null,"blockers":null,"handoff_notes":"Init command implemented. Creates ~/.config/kaizen/, failures.db, and config.yaml. Idempotent. 7 tests passing. Committed: 8a039d05","progress_percent":0,"actual_hours":null,"created_at":"2026-01-29T19:32:25.244Z","updated_at":"2026-01-29T21:19:57.615Z","created_by":null,"activity_summary":null,"story_title":"Init Command with Bootstrap","epic_id":"epic-c094d920","epic_title":"Kaizen Core - Failure Capture System","epic_priority":"P0"},{"id":"task-3e71a1ae","story_id":"story-22706cb8","title":"Define SQLite schema for failures table","status":"done","task_type":"feature","estimate_hours":2,"description":"Create SQLite schema for storing failure patterns.\n\nTables:\n- failures: id, task_id, category, details, source, created_at\n- category_stats: category, occurrence_count, last_seen, first_seen\n\nLocation: internal/failures/store.go\n\nSkill hint: database-design","context_summary":null,"working_files":null,"blockers":null,"handoff_notes":"SQLite schema implemented with failures and category_stats tables. Index on category column. All 7 tests passing. Committed: ef481a09","progress_percent":0,"actual_hours":null,"created_at":"2026-01-29T19:31:39.942Z","updated_at":"2026-01-29T20:53:50.462Z","created_by":null,"activity_summary":null,"story_title":"SQLite Failure Storage","epic_id":"epic-c094d920","epic_title":"Kaizen Core - Failure Capture System","epic_priority":"P0"},{"id":"task-a39a731e","story_id":"story-d4ffd5cd","title":"Create cross-repo integration overview","status":"todo","task_type":"chore","estimate_hours":3,"description":"Create integration overview documentation in each repo.\n\nDeliverables:\n- kaizen/docs/INTEGRATION.md - links to pokayokay/ohno\n- pokayokay/docs/integrations/README.md - overview\n- ohno/docs/INTEGRATION.md - links to kaizen\n\nConsistent terminology across all docs.\n\nSkill hint: documentation","context_summary":null,"working_files":null,"blockers":null,"handoff_notes":null,"progress_percent":0,"actual_hours":null,"created_at":"2026-01-29T19:33:00.772Z","updated_at":"2026-01-29T19:33:00.772Z","created_by":null,"activity_summary":null,"story_title":"Cross-Repo Documentation Links","epic_id":"epic-6a9ad408","epic_title":"Cross-Repo Documentation","epic_priority":"P2"},{"id":"task-b0a02050","story_id":"story-ec98cb4e","title":"Update pokayokay GUIDE.md with kaizen section","status":"todo","task_type":"chore","estimate_hours":2,"description":"Add kaizen integration section to GUIDE.md.\n\nContent:\n- What kaizen does\n- How to install\n- How integration works\n- Configuration options\n\nSkill hint: documentation","context_summary":null,"working_files":null,"blockers":null,"handoff_notes":null,"progress_percent":0,"actual_hours":null,"created_at":"2026-01-29T19:32:59.974Z","updated_at":"2026-01-29T19:32:59.974Z","created_by":null,"activity_summary":null,"story_title":"Pokayokay Integration Documentation","epic_id":"epic-595024e6","epic_title":"Pokayokay Integration","epic_priority":"P1"},{"id":"task-9946cd0c","story_id":"story-23b230ef","title":"Modify work.md to call post-review-fail hook","status":"todo","task_type":"feature","estimate_hours":3,"description":"Modify pokayokay work.md skill to integrate hook.\n\nAfter review fails:\n1. Call post-review-fail hook with args\n2. Parse hook output for action type\n3. Handle AUTO: mark task blocked, get next\n4. Handle SUGGEST: ask user confirmation\n5. Handle LOGGED: continue re-dispatch (existing behavior)\n\nLocation: pokayokay/plugins/pokayokay/skills/work/SKILL.md\n\nSkill hint: ux-design","context_summary":null,"working_files":null,"blockers":null,"handoff_notes":null,"progress_percent":0,"actual_hours":null,"created_at":"2026-01-29T19:32:59.783Z","updated_at":"2026-01-29T19:32:59.783Z","created_by":null,"activity_summary":null,"story_title":"Work.md Flow Modification","epic_id":"epic-595024e6","epic_title":"Pokayokay Integration","epic_priority":"P1"},{"id":"task-fa8cfb85","story_id":"story-301d92fb","title":"Write tests for hook script","status":"todo","task_type":"test","estimate_hours":2,"description":"Write tests for post-review-fail hook.\n\nTest cases:\n- Kaizen not installed exits gracefully\n- AUTO action creates fix task\n- SUGGEST action outputs suggestion\n- LOGGED action logs and exits\n\nSkill hint: testing-strategy","context_summary":null,"working_files":null,"blockers":null,"handoff_notes":null,"progress_percent":0,"actual_hours":null,"created_at":"2026-01-29T19:32:59.626Z","updated_at":"2026-01-29T19:32:59.626Z","created_by":null,"activity_summary":null,"story_title":"Post-Review-Fail Hook","epic_id":"epic-595024e6","epic_title":"Pokayokay Integration","epic_priority":"P1"}],"dependencies":[],"task_activity":[{"id":"act-63da0828","task_id":"task-a0d9e8f3","activity_type":"status_change","description":"Status changed from todo to in_progress","old_value":"todo","new_value":"in_progress","actor":null,"created_at":"2026-01-30T00:47:11.556Z","task_title":"Create docs/integrations/kaizen.md"},{"id":"act-a91d6eac","task_id":"task-b47f03bd","activity_type":"status_change","description":"Status changed from in_progress to done","old_value":"in_progress","new_value":"done","actor":null,"created_at":"2026-01-30T00:46:51.928Z","task_title":"Create post-review-fail.sh hook script"},{"id":"act-827ddebd","task_id":"task-b47f03bd","activity_type":"note","description":"Implementation complete. Shell script at hooks/post-review-fail.sh. Checks kaizen/jq availability, calls detect-category/capture/suggest, outputs JSON (AUTO/SUGGEST/LOGGED). 6 tests pass. Commits: 18d5715, 0d40bf2","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-30T00:46:50.684Z","task_title":"Create post-review-fail.sh hook script"},{"id":"act-992419a0","task_id":"task-b47f03bd","activity_type":"status_change","description":"Status changed from todo to in_progress","old_value":"todo","new_value":"in_progress","actor":null,"created_at":"2026-01-30T00:35:03.785Z","task_title":"Create post-review-fail.sh hook script"},{"id":"act-906f48fb","task_id":"task-572a04d3","activity_type":"status_change","description":"Status changed from in_progress to done","old_value":"in_progress","new_value":"done","actor":null,"created_at":"2026-01-30T00:34:44.718Z","task_title":"Implement ohno task creation from hook"},{"id":"act-2a3869f7","task_id":"task-572a04d3","activity_type":"note","description":"Implementation complete. OhnoClient wrapper with CreateFixTask method. Builds ohno CLI args with --type, --blocks, --description, --source flags. Parses task ID from output. 9 tests with 88.2% coverage. Commits: 12051c6, 3b809ab","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-30T00:34:43.498Z","task_title":"Implement ohno task creation from hook"},{"id":"act-846f4c59","task_id":"task-572a04d3","activity_type":"status_change","description":"Status changed from todo to in_progress","old_value":"todo","new_value":"in_progress","actor":null,"created_at":"2026-01-30T00:28:20.389Z","task_title":"Implement ohno task creation from hook"},{"id":"act-508a0e2d","task_id":"task-a8df1d51","activity_type":"status_change","description":"Status changed from in_progress to done","old_value":"in_progress","new_value":"done","actor":null,"created_at":"2026-01-30T00:26:03.892Z","task_title":"Update ohno README with source field docs"},{"id":"act-afaec280","task_id":"task-a8df1d51","activity_type":"note","description":"Documentation complete. Added Task Source Tracking section to README with all 4 source types, CLI examples, and MCP reference. Fixed MCP example syntax in review. Commits: 9c061ba, 6fe7e97","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-30T00:26:02.792Z","task_title":"Update ohno README with source field docs"},{"id":"act-355df94c","task_id":"task-a8df1d51","activity_type":"status_change","description":"Status changed from todo to in_progress","old_value":"todo","new_value":"in_progress","actor":null,"created_at":"2026-01-30T00:19:16.306Z","task_title":"Update ohno README with source field docs"},{"id":"act-825937f8","task_id":"task-0ac853b3","activity_type":"status_change","description":"Status changed from in_progress to done","old_value":"in_progress","new_value":"done","actor":null,"created_at":"2026-01-30T00:17:37.569Z","task_title":"Add --source flag to ohno create command"},{"id":"act-eaacc88f","task_id":"task-0ac853b3","activity_type":"note","description":"Implementation complete. Added --source flag to ohno create command with validation. Exported TaskSource from ohno-core. Added 5 tests. All 416 tests pass. Commit: 106c849","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-30T00:17:36.337Z","task_title":"Add --source flag to ohno create command"},{"id":"act-3dd5ae66","task_id":"task-0ac853b3","activity_type":"status_change","description":"Status changed from todo to in_progress","old_value":"todo","new_value":"in_progress","actor":null,"created_at":"2026-01-30T00:09:34.070Z","task_title":"Add --source flag to ohno create command"},{"id":"act-ac96e49e","task_id":"task-fb3ba58f","activity_type":"status_change","description":"Status changed from in_progress to done","old_value":"in_progress","new_value":"done","actor":null,"created_at":"2026-01-30T00:08:53.124Z","task_title":"Write tests for source field"},{"id":"act-1d5f3a85","task_id":"task-fb3ba58f","activity_type":"note","description":"Tests already implemented in task-e9d6123a via TDD. 12 tests cover all specified cases: default \"human\" (db.test.ts:1007, server.test.ts:781), --source flag (db.test.ts:1011-1031, server.test.ts:787-811), invalid rejection (server.test.ts:814-821), migration (db.test.ts:1051).","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-30T00:08:51.891Z","task_title":"Write tests for source field"},{"id":"act-f468a6b4","task_id":"task-fb3ba58f","activity_type":"status_change","description":"Status changed from todo to in_progress","old_value":"todo","new_value":"in_progress","actor":null,"created_at":"2026-01-30T00:08:42.352Z","task_title":"Write tests for source field"},{"id":"act-10bdb3dd","task_id":"task-e9d6123a","activity_type":"status_change","description":"Status changed from in_progress to done","old_value":"in_progress","new_value":"done","actor":null,"created_at":"2026-01-30T00:08:02.291Z","task_title":"Add source field to ohno task schema"},{"id":"act-1ceed7cd","task_id":"task-e9d6123a","activity_type":"note","description":"Implementation complete. Added TaskSource type with 4 values (human, pokayokay-plan, kaizen-fix, kaizen-suggest). Updated types.ts, schema.ts, db.ts, server.ts. Added 12 tests (7 core, 5 MCP). All 412 tests pass. Commit: 5e7a3eb","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-30T00:08:01.224Z","task_title":"Add source field to ohno task schema"},{"id":"act-c4228a6d","task_id":"task-e9d6123a","activity_type":"status_change","description":"Status changed from todo to in_progress","old_value":"todo","new_value":"in_progress","actor":null,"created_at":"2026-01-29T23:57:57.738Z","task_title":"Add source field to ohno task schema"},{"id":"act-2ddb6388","task_id":"task-e418042a","activity_type":"status_change","description":"Status changed from in_progress to done","old_value":"in_progress","new_value":"done","actor":null,"created_at":"2026-01-29T23:47:17.340Z","task_title":"Implement global vs project-local storage resolution"},{"id":"act-2c71da87","task_id":"task-e418042a","activity_type":"note","description":"Created resolver.go with StorageResolver struct. Methods: NewStorageResolver, ResolveDBPath, GetGlobalDBPath, GetProjectDBPath. Walks up directory tree to find .kaizen/failures.db, falls back to ~/.config/kaizen/failures.db. 9 tests pass covering all scenarios. Commit: c91b84fb","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-29T23:47:16.427Z","task_title":"Implement global vs project-local storage resolution"},{"id":"act-5bac0911","task_id":"task-e418042a","activity_type":"status_change","description":"Status changed from todo to in_progress","old_value":"todo","new_value":"in_progress","actor":null,"created_at":"2026-01-29T23:44:42.351Z","task_title":"Implement global vs project-local storage resolution"},{"id":"act-1309522b","task_id":"task-73abaea4","activity_type":"status_change","description":"Status changed from in_progress to done","old_value":"in_progress","new_value":"done","actor":null,"created_at":"2026-01-29T23:44:23.798Z","task_title":"Write tests for failure store"},{"id":"act-f193a6b6","task_id":"task-73abaea4","activity_type":"note","description":"Skipped - comprehensive tests already exist in store_test.go. 24 test functions cover: Insert/retrieve (TestInsert, TestGetByCategory), increment count (TestIncrementCount*), edge cases (TestGetByCategoryEmpty, TestGetOccurrenceCountNonExistent). Global vs project-local is CLI-level concern, not store-level.","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-29T23:44:23.054Z","task_title":"Write tests for failure store"},{"id":"act-56210aa6","task_id":"task-73abaea4","activity_type":"status_change","description":"Status changed from todo to in_progress","old_value":"todo","new_value":"in_progress","actor":null,"created_at":"2026-01-29T23:44:13.837Z","task_title":"Write tests for failure store"},{"id":"act-f0ef0e39","task_id":"task-49403290","activity_type":"status_change","description":"Status changed from in_progress to done","old_value":"in_progress","new_value":"done","actor":null,"created_at":"2026-01-29T23:41:43.081Z","task_title":"Write tests for capture command"},{"id":"act-24d237dc","task_id":"task-49403290","activity_type":"note","description":"Skipped - tests already implemented in task-c435046d (capture_test.go). Tests cover: valid capture stores failure (TestCaptureCommand), error handling (TestCaptureCommandError), multiple captures (TestCaptureCommandMultipleCaptures), JSON format validation, integration test.","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-29T23:41:42.266Z","task_title":"Write tests for capture command"},{"id":"act-3a716ddc","task_id":"task-49403290","activity_type":"status_change","description":"Status changed from todo to in_progress","old_value":"todo","new_value":"in_progress","actor":null,"created_at":"2026-01-29T23:41:32.606Z","task_title":"Write tests for capture command"},{"id":"act-f7b769e6","task_id":"task-c435046d","activity_type":"status_change","description":"Status changed from in_progress to done","old_value":"in_progress","new_value":"done","actor":null,"created_at":"2026-01-29T23:41:03.079Z","task_title":"Implement capture command CLI"},{"id":"act-56f8cd60","task_id":"task-c435046d","activity_type":"note","description":"Spec review: PASS (semantic flag-library note dismissed - manual validation is standard Go idiom matching all other commands). Tests pass. Created capture.go with runCaptureCommand, integrated into main.go with all 4 required flags. Tests cover success, error, multiple captures, integration. Commit: f10fdf68","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-29T23:41:01.985Z","task_title":"Implement capture command CLI"},{"id":"act-0c79cda9","task_id":"task-c435046d","activity_type":"status_change","description":"Status changed from todo to in_progress","old_value":"todo","new_value":"in_progress","actor":null,"created_at":"2026-01-29T23:31:22.604Z","task_title":"Implement capture command CLI"},{"id":"act-2880ae1c","task_id":"task-0d6a0ac8","activity_type":"status_change","description":"Status changed from in_progress to done","old_value":"in_progress","new_value":"done","actor":null,"created_at":"2026-01-29T23:29:51.386Z","task_title":"Write tests for detect-category"},{"id":"act-c6ec0a12","task_id":"task-0d6a0ac8","activity_type":"note","description":"Skipped - tests already implemented in task-d018356d (patterns_test.go: TestDetectCategory, TestDetectAllCategories) and task-562fa218 (detect_test.go: TestDetectCategoryCommand). All required cases covered: each category, unknown, case insensitive, multiple matches.","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-29T23:29:50.401Z","task_title":"Write tests for detect-category"},{"id":"act-c0075a62","task_id":"task-0d6a0ac8","activity_type":"status_change","description":"Status changed from todo to in_progress","old_value":"todo","new_value":"in_progress","actor":null,"created_at":"2026-01-29T23:29:40.635Z","task_title":"Write tests for detect-category"},{"id":"act-3f181117","task_id":"task-562fa218","activity_type":"status_change","description":"Status changed from in_progress to done","old_value":"in_progress","new_value":"done","actor":null,"created_at":"2026-01-29T23:29:06.904Z","task_title":"Implement detect-category command CLI"},{"id":"act-2e1e9bc6","task_id":"task-562fa218","activity_type":"note","description":"Spec review: PASS. Quality review: PASS. Created detect.go with runDetectCategoryCommand, integrated into main.go with --details flag. Tests cover all 3 categories, multiple matches, no match, case insensitivity. Commit: 63e021f","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-29T23:29:06.182Z","task_title":"Implement detect-category command CLI"},{"id":"act-9b6923e7","task_id":"task-562fa218","activity_type":"status_change","description":"Status changed from todo to in_progress","old_value":"todo","new_value":"in_progress","actor":null,"created_at":"2026-01-29T23:13:37.665Z","task_title":"Implement detect-category command CLI"},{"id":"act-be857037","task_id":"task-d018356d","activity_type":"status_change","description":"Status changed from in_progress to done","old_value":"in_progress","new_value":"done","actor":null,"created_at":"2026-01-29T23:13:19.941Z","task_title":"Implement pattern matching for category detection"},{"id":"act-ffa6fb2a","task_id":"task-d018356d","activity_type":"note","description":"Spec review: PASS. Quality review: PASS. Added Category type, constants, CategoryPattern struct, DetectCategory() and DetectAllCategories() functions. 20 test cases covering all patterns and edge cases. Commit: 1343ae6","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-29T23:13:18.998Z","task_title":"Implement pattern matching for category detection"},{"id":"act-2bdfe0c2","task_id":"task-d018356d","activity_type":"status_change","description":"Status changed from todo to in_progress","old_value":"todo","new_value":"in_progress","actor":null,"created_at":"2026-01-29T23:09:21.925Z","task_title":"Implement pattern matching for category detection"},{"id":"act-b688a862","task_id":"task-edca3922","activity_type":"status_change","description":"Status changed from in_progress to done","old_value":"in_progress","new_value":"done","actor":null,"created_at":"2026-01-29T23:07:36.168Z","task_title":"Write tests for suggest command"},{"id":"act-493bca75","task_id":"task-edca3922","activity_type":"note","description":"Most tests already existed from task-82fa8df8. Added TestSuggestCommandLowConfidence (1 occurrence → log-only). All 4 test cases now pass: high/auto-create, medium/suggest, low/log-only, missing template. Commit: 4e5f40d","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-29T23:07:34.958Z","task_title":"Write tests for suggest command"},{"id":"act-108849bc","task_id":"task-edca3922","activity_type":"status_change","description":"Status changed from todo to in_progress","old_value":"todo","new_value":"in_progress","actor":null,"created_at":"2026-01-29T23:06:45.368Z","task_title":"Write tests for suggest command"},{"id":"act-5935a490","task_id":"task-82fa8df8","activity_type":"status_change","description":"Status changed from in_progress to done","old_value":"in_progress","new_value":"done","actor":null,"created_at":"2026-01-29T23:06:19.174Z","task_title":"Implement suggest command CLI"},{"id":"act-ba7c4c5f","task_id":"task-82fa8df8","activity_type":"note","description":"Spec review: PASS. Quality review: PASS. Created suggest.go with runSuggestCommand, integrated into main.go, tests cover happy path + missing template + missing db. Commit: 57906de","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-29T23:06:18.156Z","task_title":"Implement suggest command CLI"},{"id":"act-9083287a","task_id":"task-82fa8df8","activity_type":"status_change","description":"Status changed from todo to in_progress","old_value":"todo","new_value":"in_progress","actor":null,"created_at":"2026-01-29T22:49:39.774Z","task_title":"Implement suggest command CLI"},{"id":"act-4d48a471","task_id":"task-0478bf44","activity_type":"status_change","description":"Status changed from in_progress to done","old_value":"in_progress","new_value":"done","actor":null,"created_at":"2026-01-29T22:49:22.760Z","task_title":"Implement confidence scoring logic"},{"id":"act-4dffea69","task_id":"task-0478bf44","activity_type":"note","description":"Spec review: PASS. Quality review: PASS. Created patterns.go with ConfidenceLevel/Action types, Confidence struct, and CalculateConfidence function. Tests cover all boundary conditions (0, 1, 2, 4, 5, 10). Commit: d4cb459","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-29T22:49:21.193Z","task_title":"Implement confidence scoring logic"},{"id":"act-e9c9e257","task_id":"task-0478bf44","activity_type":"status_change","description":"Status changed from todo to in_progress","old_value":"todo","new_value":"in_progress","actor":null,"created_at":"2026-01-29T22:46:25.559Z","task_title":"Implement confidence scoring logic"},{"id":"act-6818417e","task_id":"task-1cddadec","activity_type":"note","description":"Skipped - already implemented in task-15170e38. All required test cases present: load template, variable substitution, unknown category error, missing variable handling.","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-29T22:39:47.184Z","task_title":"Write tests for template system"},{"id":"act-52f54755","task_id":"task-1cddadec","activity_type":"status_change","description":"Status changed from todo to done","old_value":"todo","new_value":"done","actor":null,"created_at":"2026-01-29T22:39:46.193Z","task_title":"Write tests for template system"},{"id":"act-dcf8b1a9","task_id":"task-59fb692b","activity_type":"note","description":"Skipped - already implemented in task-15170e38 (YAML template parser). RenderTitle/RenderDescription methods support all variables via map[string]string parameter.","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-29T22:39:09.206Z","task_title":"Implement template variable substitution"},{"id":"act-18f66467","task_id":"task-59fb692b","activity_type":"status_change","description":"Status changed from todo to done","old_value":"todo","new_value":"done","actor":null,"created_at":"2026-01-29T22:39:08.378Z","task_title":"Implement template variable substitution"},{"id":"act-450c1a85","task_id":"task-15170e38","activity_type":"status_change","description":"Status changed from in_progress to done","old_value":"in_progress","new_value":"done","actor":null,"created_at":"2026-01-29T22:38:38.415Z","task_title":"Create YAML template structure and parser"},{"id":"act-ef313e37","task_id":"task-15170e38","activity_type":"note","description":"Spec review: PASS. Quality review: PASS. Created templates.go with TemplateLoader, LoadTemplate, LoadAllTemplates, RenderTitle, RenderDescription. 82.5% test coverage. Commit: 225c968","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-29T22:38:37.372Z","task_title":"Create YAML template structure and parser"},{"id":"act-a39db662","task_id":"task-15170e38","activity_type":"status_change","description":"Status changed from todo to in_progress","old_value":"todo","new_value":"in_progress","actor":null,"created_at":"2026-01-29T22:30:03.677Z","task_title":"Create YAML template structure and parser"},{"id":"act-add11c90","task_id":"task-17b150ce","activity_type":"status_change","description":"Status changed from in_progress to done","old_value":"in_progress","new_value":"done","actor":null,"created_at":"2026-01-29T22:29:46.893Z","task_title":"Create initial fix task templates"},{"id":"act-004bd956","task_id":"task-17b150ce","activity_type":"note","description":"Spec review: PASS. Quality review: PASS (after 1 fix cycle). Created 3 YAML templates with tests. Commits: 3bb5fba (initial), 4ab6935 (quality fixes)","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-29T22:29:45.950Z","task_title":"Create initial fix task templates"},{"id":"act-e25be093","task_id":"task-17b150ce","activity_type":"status_change","description":"Status changed from todo to in_progress","old_value":"todo","new_value":"in_progress","actor":null,"created_at":"2026-01-29T22:17:38.130Z","task_title":"Create initial fix task templates"},{"id":"act-538e9d55","task_id":"task-0f1f0a36","activity_type":"status_change","description":"Status changed from in_progress to done","old_value":"in_progress","new_value":"done","actor":null,"created_at":"2026-01-29T22:17:21.341Z","task_title":"Implement failure store CRUD operations"},{"id":"act-62b3c584","task_id":"task-0f1f0a36","activity_type":"note","description":"Spec review: PASS. Quality review: PASS. All 4 CRUD methods implemented with comprehensive tests (81.2% coverage). Commit: cd4d00fecc26e82b7a9a6c45c9534dbd3d69f964","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-29T22:17:20.342Z","task_title":"Implement failure store CRUD operations"},{"id":"act-4bcfd4cd","task_id":"task-0f1f0a36","activity_type":"status_change","description":"Status changed from todo to in_progress","old_value":"todo","new_value":"in_progress","actor":null,"created_at":"2026-01-29T22:10:44.319Z","task_title":"Implement failure store CRUD operations"},{"id":"act-b5f4857d","task_id":"task-0f1f0a36","activity_type":"note","description":"Handoff notes updated","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-29T22:08:40.398Z","task_title":"Implement failure store CRUD operations"},{"id":"act-de9f1915","task_id":"task-70df5f5e","activity_type":"status_change","description":"Status changed from todo to done","old_value":"todo","new_value":"done","actor":null,"created_at":"2026-01-29T22:05:57.500Z","task_title":"Write tests for init command"},{"id":"act-281ab33c","task_id":"task-419566a4","activity_type":"note","description":"Spec review: PASS. Quality review: PASS.","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-29T22:05:21.112Z","task_title":"Implement bootstrap from existing failures directory"},{"id":"act-ee572182","task_id":"task-419566a4","activity_type":"status_change","description":"Status changed from in_progress to done","old_value":"in_progress","new_value":"done","actor":null,"created_at":"2026-01-29T22:05:20.767Z","task_title":"Implement bootstrap from existing failures directory"},{"id":"act-31fdeb36","task_id":"task-419566a4","activity_type":"status_change","description":"Status changed from todo to in_progress","old_value":"todo","new_value":"in_progress","actor":null,"created_at":"2026-01-29T21:20:20.225Z","task_title":"Implement bootstrap from existing failures directory"},{"id":"act-8cacbb96","task_id":"task-5932d9a0","activity_type":"note","description":"Spec review: PASS. Quality review: PASS. All init tests passing.","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-29T21:19:58.676Z","task_title":"Implement init command with directory setup"},{"id":"act-6ebe5bb1","task_id":"task-5932d9a0","activity_type":"status_change","description":"Status changed from in_progress to done","old_value":"in_progress","new_value":"done","actor":null,"created_at":"2026-01-29T21:19:57.617Z","task_title":"Implement init command with directory setup"},{"id":"act-c94b7cbd","task_id":"task-5932d9a0","activity_type":"status_change","description":"Status changed from todo to in_progress","old_value":"todo","new_value":"in_progress","actor":null,"created_at":"2026-01-29T20:57:14.698Z","task_title":"Implement init command with directory setup"},{"id":"act-bbc14853","task_id":"task-3e71a1ae","activity_type":"note","description":"Spec review: PASS - All acceptance criteria met. Quality review: PASS - Code meets standards.","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-29T20:56:58.158Z","task_title":"Define SQLite schema for failures table"},{"id":"act-19231fd2","task_id":"task-3e71a1ae","activity_type":"status_change","description":"Status changed from in_progress to done","old_value":"in_progress","new_value":"done","actor":null,"created_at":"2026-01-29T20:53:50.462Z","task_title":"Define SQLite schema for failures table"},{"id":"act-d682ec6f","task_id":"task-3e71a1ae","activity_type":"status_change","description":"Status changed from todo to in_progress","old_value":"todo","new_value":"in_progress","actor":null,"created_at":"2026-01-29T20:26:56.985Z","task_title":"Define SQLite schema for failures table"},{"id":"act-fa55148e","task_id":"task-a39a731e","activity_type":"created","description":"Task created: Create cross-repo integration overview","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-29T19:33:00.772Z","task_title":"Create cross-repo integration overview"},{"id":"act-d3ca82d7","task_id":"task-a8df1d51","activity_type":"created","description":"Task created: Update ohno README with source field docs","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-29T19:33:00.655Z","task_title":"Update ohno README with source field docs"},{"id":"act-dcfe10a5","task_id":"task-fb3ba58f","activity_type":"created","description":"Task created: Write tests for source field","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-29T19:33:00.532Z","task_title":"Write tests for source field"},{"id":"act-5707efb5","task_id":"task-0ac853b3","activity_type":"created","description":"Task created: Add --source flag to ohno create command","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-29T19:33:00.411Z","task_title":"Add --source flag to ohno create command"},{"id":"act-b0f02469","task_id":"task-e9d6123a","activity_type":"created","description":"Task created: Add source field to ohno task schema","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-29T19:33:00.252Z","task_title":"Add source field to ohno task schema"},{"id":"act-31b69642","task_id":"task-a0d9e8f3","activity_type":"created","description":"Task created: Create docs/integrations/kaizen.md","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-29T19:33:00.114Z","task_title":"Create docs/integrations/kaizen.md"},{"id":"act-0700c2e4","task_id":"task-b0a02050","activity_type":"created","description":"Task created: Update pokayokay GUIDE.md with kaizen section","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-29T19:32:59.975Z","task_title":"Update pokayokay GUIDE.md with kaizen section"},{"id":"act-036afe03","task_id":"task-9946cd0c","activity_type":"created","description":"Task created: Modify work.md to call post-review-fail hook","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-29T19:32:59.784Z","task_title":"Modify work.md to call post-review-fail hook"},{"id":"act-c112944b","task_id":"task-fa8cfb85","activity_type":"created","description":"Task created: Write tests for hook script","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-29T19:32:59.627Z","task_title":"Write tests for hook script"},{"id":"act-03d1beff","task_id":"task-572a04d3","activity_type":"created","description":"Task created: Implement ohno task creation from hook","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-29T19:32:59.434Z","task_title":"Implement ohno task creation from hook"},{"id":"act-07b1d0ef","task_id":"task-b47f03bd","activity_type":"created","description":"Task created: Create post-review-fail.sh hook script","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-29T19:32:59.228Z","task_title":"Create post-review-fail.sh hook script"},{"id":"act-1a710b43","task_id":"task-70df5f5e","activity_type":"created","description":"Task created: Write tests for init command","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-29T19:32:25.526Z","task_title":"Write tests for init command"},{"id":"act-81c7146c","task_id":"task-419566a4","activity_type":"created","description":"Task created: Implement bootstrap from existing failures directory","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-29T19:32:25.375Z","task_title":"Implement bootstrap from existing failures directory"},{"id":"act-2e09ef42","task_id":"task-5932d9a0","activity_type":"created","description":"Task created: Implement init command with directory setup","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-29T19:32:25.245Z","task_title":"Implement init command with directory setup"},{"id":"act-73873899","task_id":"task-1cddadec","activity_type":"created","description":"Task created: Write tests for template system","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-29T19:32:25.082Z","task_title":"Write tests for template system"},{"id":"act-59fd5864","task_id":"task-59fb692b","activity_type":"created","description":"Task created: Implement template variable substitution","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-29T19:32:24.947Z","task_title":"Implement template variable substitution"},{"id":"act-76bf12a7","task_id":"task-17b150ce","activity_type":"created","description":"Task created: Create initial fix task templates","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-29T19:32:24.789Z","task_title":"Create initial fix task templates"},{"id":"act-9ff2f909","task_id":"task-15170e38","activity_type":"created","description":"Task created: Create YAML template structure and parser","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-29T19:32:24.616Z","task_title":"Create YAML template structure and parser"},{"id":"act-c9c12036","task_id":"task-edca3922","activity_type":"created","description":"Task created: Write tests for suggest command","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-29T19:32:03.479Z","task_title":"Write tests for suggest command"},{"id":"act-edd63155","task_id":"task-82fa8df8","activity_type":"created","description":"Task created: Implement suggest command CLI","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-29T19:32:03.347Z","task_title":"Implement suggest command CLI"},{"id":"act-f801c6f1","task_id":"task-0478bf44","activity_type":"created","description":"Task created: Implement confidence scoring logic","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-29T19:32:03.198Z","task_title":"Implement confidence scoring logic"},{"id":"act-e89afd7f","task_id":"task-0d6a0ac8","activity_type":"created","description":"Task created: Write tests for detect-category","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-29T19:32:03.057Z","task_title":"Write tests for detect-category"},{"id":"act-0b27ae20","task_id":"task-562fa218","activity_type":"created","description":"Task created: Implement detect-category command CLI","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-29T19:32:02.911Z","task_title":"Implement detect-category command CLI"},{"id":"act-d8c2239c","task_id":"task-d018356d","activity_type":"created","description":"Task created: Implement pattern matching for category detection","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-29T19:32:02.775Z","task_title":"Implement pattern matching for category detection"},{"id":"act-b0c3255e","task_id":"task-49403290","activity_type":"created","description":"Task created: Write tests for capture command","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-29T19:32:02.641Z","task_title":"Write tests for capture command"},{"id":"act-42558c93","task_id":"task-c435046d","activity_type":"created","description":"Task created: Implement capture command CLI","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-29T19:32:02.486Z","task_title":"Implement capture command CLI"},{"id":"act-0e031ec6","task_id":"task-73abaea4","activity_type":"created","description":"Task created: Write tests for failure store","old_value":null,"new_value":null,"actor":null,"created_at":"2026-01-29T19:31:40.424Z","task_title":"Write tests for failure store"}],"task_files":[],"task_dependencies":[{"id":"dep-c2f3d7c8","task_id":"task-0f1f0a36","depends_on_task_id":"task-3e71a1ae","dependency_type":"blocks","created_at":"2026-01-29T19:36:18.409Z","depends_on_title":"Define SQLite schema for failures table","depends_on_status":"done"},{"id":"dep-4c5fb0aa","task_id":"task-e418042a","depends_on_task_id":"task-0f1f0a36","dependency_type":"blocks","created_at":"2026-01-29T19:36:18.608Z","depends_on_title":"Implement failure store CRUD operations","depends_on_status":"done"},{"id":"dep-cb8be846","task_id":"task-73abaea4","depends_on_task_id":"task-0f1f0a36","dependency_type":"blocks","created_at":"2026-01-29T19:36:18.778Z","depends_on_title":"Implement failure store CRUD operations","depends_on_status":"done"},{"id":"dep-7ccd5a76","task_id":"task-c435046d","depends_on_task_id":"task-0f1f0a36","dependency_type":"blocks","created_at":"2026-01-29T19:36:18.921Z","depends_on_title":"Implement failure store CRUD operations","depends_on_status":"done"},{"id":"dep-bc5d6e81","task_id":"task-49403290","depends_on_task_id":"task-c435046d","dependency_type":"blocks","created_at":"2026-01-29T19:36:19.073Z","depends_on_title":"Implement capture command CLI","depends_on_status":"done"},{"id":"dep-cbcdd7e9","task_id":"task-562fa218","depends_on_task_id":"task-d018356d","dependency_type":"blocks","created_at":"2026-01-29T19:36:19.192Z","depends_on_title":"Implement pattern matching for category detection","depends_on_status":"done"},{"id":"dep-08bae3f3","task_id":"task-0d6a0ac8","depends_on_task_id":"task-562fa218","dependency_type":"blocks","created_at":"2026-01-29T19:36:19.311Z","depends_on_title":"Implement detect-category command CLI","depends_on_status":"done"},{"id":"dep-4566d9ea","task_id":"task-82fa8df8","depends_on_task_id":"task-0478bf44","dependency_type":"blocks","created_at":"2026-01-29T19:36:19.429Z","depends_on_title":"Implement confidence scoring logic","depends_on_status":"done"},{"id":"dep-224eb473","task_id":"task-82fa8df8","depends_on_task_id":"task-15170e38","dependency_type":"blocks","created_at":"2026-01-29T19:36:19.557Z","depends_on_title":"Create YAML template structure and parser","depends_on_status":"done"},{"id":"dep-304d256c","task_id":"task-edca3922","depends_on_task_id":"task-82fa8df8","dependency_type":"blocks","created_at":"2026-01-29T19:36:19.822Z","depends_on_title":"Implement suggest command CLI","depends_on_status":"done"},{"id":"dep-dffc2f9b","task_id":"task-59fb692b","depends_on_task_id":"task-15170e38","dependency_type":"blocks","created_at":"2026-01-29T19:36:34.543Z","depends_on_title":"Create YAML template structure and parser","depends_on_status":"done"},{"id":"dep-a2e2b087","task_id":"task-1cddadec","depends_on_task_id":"task-59fb692b","dependency_type":"blocks","created_at":"2026-01-29T19:36:34.703Z","depends_on_title":"Implement template variable substitution","depends_on_status":"done"},{"id":"dep-43f0468d","task_id":"task-419566a4","depends_on_task_id":"task-5932d9a0","dependency_type":"blocks","created_at":"2026-01-29T19:36:34.850Z","depends_on_title":"Implement init command with directory setup","depends_on_status":"done"},{"id":"dep-e409f584","task_id":"task-70df5f5e","depends_on_task_id":"task-419566a4","dependency_type":"blocks","created_at":"2026-01-29T19:36:35.015Z","depends_on_title":"Implement bootstrap from existing failures directory","depends_on_status":"done"},{"id":"dep-73d3c556","task_id":"task-b47f03bd","depends_on_task_id":"task-82fa8df8","dependency_type":"blocks","created_at":"2026-01-29T19:36:35.148Z","depends_on_title":"Implement suggest command CLI","depends_on_status":"done"},{"id":"dep-545b47e8","task_id":"task-572a04d3","depends_on_task_id":"task-82fa8df8","dependency_type":"blocks","created_at":"2026-01-29T19:36:35.314Z","depends_on_title":"Implement suggest command CLI","depends_on_status":"done"},{"id":"dep-80900b89","task_id":"task-9946cd0c","depends_on_task_id":"task-b47f03bd","dependency_type":"blocks","created_at":"2026-01-29T19:36:35.444Z","depends_on_title":"Create post-review-fail.sh hook script","depends_on_status":"done"},{"id":"dep-473912e1","task_id":"task-fa8cfb85","depends_on_task_id":"task-b47f03bd","dependency_type":"blocks","created_at":"2026-01-29T19:36:35.574Z","depends_on_title":"Create post-review-fail.sh hook script","depends_on_status":"done"},{"id":"dep-e91bf6cc","task_id":"task-0ac853b3","depends_on_task_id":"task-e9d6123a","dependency_type":"blocks","created_at":"2026-01-29T19:36:35.700Z","depends_on_title":"Add source field to ohno task schema","depends_on_status":"done"},{"id":"dep-2234287a","task_id":"task-fb3ba58f","depends_on_task_id":"task-e9d6123a","dependency_type":"blocks","created_at":"2026-01-29T19:36:35.818Z","depends_on_title":"Add source field to ohno task schema","depends_on_status":"done"},{"id":"dep-19179bd4","task_id":"task-a8df1d51","depends_on_task_id":"task-e9d6123a","dependency_type":"blocks","created_at":"2026-01-29T23:57:41.260Z","depends_on_title":"Add source field to ohno task schema","depends_on_status":"done"},{"id":"dep-ded51a11","task_id":"task-a8df1d51","depends_on_task_id":"task-0ac853b3","dependency_type":"blocks","created_at":"2026-01-29T23:57:41.893Z","depends_on_title":"Add --source flag to ohno create command","depends_on_status":"done"},{"id":"dep-a22ff403","task_id":"task-a0d9e8f3","depends_on_task_id":"task-b47f03bd","dependency_type":"blocks","created_at":"2026-01-30T00:28:00.261Z","depends_on_title":"Create post-review-fail.sh hook script","depends_on_status":"done"},{"id":"dep-5dfb386f","task_id":"task-b0a02050","depends_on_task_id":"task-b47f03bd","dependency_type":"blocks","created_at":"2026-01-30T00:28:01.085Z","depends_on_title":"Create post-review-fail.sh hook script","depends_on_status":"done"}],"stats":{"total_tasks":30,"done_tasks":25,"blocked_tasks":0,"in_progress_tasks":1,"review_tasks":0,"todo_tasks":4,"completion_percent":83,"total_stories":13,"done_stories":0,"total_epics":4,"done_epics":0,"p0_tasks":19,"p1_tasks":10,"total_estimate_hours":68,"total_actual_hours":0,"tasks_with_details":30,"tasks_with_activity":30,"tasks_with_files":0,"tasks_with_dependencies":22}};</script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-card: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border: #475569;
            --blue: #3b82f6;
            --green: #22c55e;
            --yellow: #eab308;
            --red: #ef4444;
            --purple: #a855f7;
            --orange: #f97316;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
        }

        .header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h1 { font-size: 1.25rem; font-weight: 600; }

        .sync-status {
            font-size: 0.75rem;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .sync-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--green);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .stats { display: flex; gap: 1.5rem; font-size: 0.875rem; }
        .stat-value { font-weight: 600; }
        .stat-label { color: var(--text-secondary); margin-left: 0.25rem; }

        .progress-bar-container {
            background: var(--bg-secondary);
            padding: 0.5rem 1.5rem;
            border-bottom: 1px solid var(--border);
        }

        .progress-bar {
            height: 6px;
            background: var(--bg-card);
            border-radius: 3px;
            overflow: hidden;
            display: flex;
        }

        .progress-done { background: var(--green); }
        .progress-review { background: var(--purple); }
        .progress-in-progress { background: var(--blue); }
        .progress-blocked { background: var(--red); }

        .filters {
            background: var(--bg-secondary);
            padding: 0.5rem 1.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .filter-group { display: flex; align-items: center; gap: 0.5rem; }

        .filter-label {
            font-size: 0.7rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .filter-select {
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
        }

        .board {
            display: flex;
            gap: 1rem;
            padding: 1rem 1.5rem;
            overflow-x: auto;
            min-height: calc(100vh - 140px);
        }

        .column {
            min-width: 280px;
            max-width: 280px;
            background: var(--bg-secondary);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            max-height: calc(100vh - 160px);
        }

        .column-header {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .column-todo .column-header { border-left: 3px solid var(--text-muted); }
        .column-in_progress .column-header { border-left: 3px solid var(--blue); }
        .column-review .column-header { border-left: 3px solid var(--purple); }
        .column-done .column-header { border-left: 3px solid var(--green); }
        .column-blocked .column-header { border-left: 3px solid var(--red); }

        .column-title { font-weight: 600; font-size: 0.875rem; }

        .column-count {
            background: var(--bg-card);
            padding: 0.125rem 0.5rem;
            border-radius: 10px;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .column-cards {
            padding: 0.5rem;
            overflow-y: auto;
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .card {
            background: var(--bg-card);
            border-radius: 6px;
            padding: 0.75rem;
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.1s;
        }

        .card:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.375rem;
        }

        .card-id { font-size: 0.7rem; color: var(--text-muted); font-family: monospace; }

        .card-priority { font-size: 0.6rem; padding: 0.1rem 0.3rem; border-radius: 3px; font-weight: 600; }
        .priority-P0 { background: var(--red); color: white; }
        .priority-P1 { background: var(--orange); color: white; }
        .priority-P2 { background: var(--yellow); color: black; }
        .priority-P3 { background: var(--text-muted); color: white; }

        .card-title { font-size: 0.8rem; font-weight: 500; line-height: 1.3; margin-bottom: 0.375rem; }

        .card-meta { display: flex; justify-content: space-between; font-size: 0.7rem; color: var(--text-muted); }
        .card-type { background: var(--bg-secondary); padding: 0.1rem 0.3rem; border-radius: 3px; }

        .card-breadcrumb {
            font-size: 0.65rem;
            color: var(--text-muted);
            margin-bottom: 0.375rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .card-hierarchy {
            font-size: 0.65rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        .card-hierarchy:first-of-type {
            padding-top: 0.375rem;
            border-top: 1px solid var(--border);
        }
        .card-hierarchy-label {
            color: var(--text-muted);
            font-size: 0.6rem;
        }
        .card-completion {
            background: var(--bg-secondary);
            color: var(--text-muted);
            padding: 0.1rem 0.3rem;
            border-radius: 3px;
            font-size: 0.6rem;
            margin-left: auto;
        }

        .card-orphan {
            font-size: 0.6rem;
            color: var(--orange);
            opacity: 0.8;
        }

        .group-header {
            padding: 0.5rem;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-secondary);
            border-bottom: 1px solid var(--border);
            margin-top: 0.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .group-header:first-child { margin-top: 0; }
        .group-name { display: flex; align-items: center; gap: 0.5rem; }

        .hierarchy-view {
            padding: 1rem 1.5rem;
            max-width: 900px;
        }

        .epic-section, .story-section {
            margin-bottom: 0.5rem;
        }

        .epic-header, .story-header, .orphan-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.75rem;
            background: var(--bg-secondary);
            border-radius: 6px;
            cursor: pointer;
            user-select: none;
        }

        .epic-header:hover, .story-header:hover, .orphan-header:hover {
            background: var(--bg-card);
        }

        .collapse-icon {
            font-size: 0.7rem;
            color: var(--text-muted);
            width: 1rem;
        }

        .epic-title { font-weight: 600; font-size: 0.9rem; }
        .story-title { font-weight: 500; font-size: 0.85rem; color: var(--text-secondary); }

        .hierarchy-badge {
            margin-left: auto;
            font-size: 0.7rem;
            color: var(--text-muted);
        }

        .epic-content, .story-content, .orphan-content {
            margin-left: 1.5rem;
            border-left: 1px solid var(--border);
            padding-left: 0.75rem;
        }

        .epic-section.collapsed .epic-content,
        .story-section.collapsed .story-content,
        .orphan-section.collapsed .orphan-content {
            display: none;
        }

        .hierarchy-task {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.375rem 0.5rem;
            font-size: 0.8rem;
            cursor: pointer;
            border-radius: 4px;
        }

        .hierarchy-task:hover {
            background: var(--bg-card);
        }

        .task-id-link {
            font-family: monospace;
            font-size: 0.7rem;
            color: var(--text-muted);
        }

        .task-title-text { flex: 1; }

        .status-badge {
            font-size: 0.65rem;
            padding: 0.1rem 0.3rem;
            border-radius: 3px;
            font-weight: 500;
        }
        .status-todo { background: var(--text-muted); color: white; }
        .status-in_progress { background: var(--blue); color: white; }
        .status-review { background: var(--purple); color: white; }
        .status-done { background: var(--green); color: white; }
        .status-blocked { background: var(--red); color: white; }

        .empty { text-align: center; padding: 2rem 1rem; color: var(--text-muted); font-size: 0.8rem; }

        .no-data {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: calc(100vh - 80px);
            color: var(--text-secondary);
            text-align: center;
            padding: 2rem;
        }

        .no-data code { background: var(--bg-card); padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.875rem; }

        .detail-backdrop {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5);
            opacity: 0; visibility: hidden;
            transition: opacity 0.2s, visibility 0.2s;
            z-index: 200;
        }
        .detail-backdrop.open { opacity: 1; visibility: visible; }

        .detail-panel {
            position: fixed; top: 0; right: -600px;
            width: 600px; max-width: 100vw; height: 100vh;
            background: var(--bg-secondary);
            border-left: 1px solid var(--border);
            overflow-y: auto;
            transition: right 0.3s ease-out;
            z-index: 201;
        }
        .detail-panel.open { right: 0; }

        .detail-header {
            padding: 1.25rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            position: sticky; top: 0;
            background: var(--bg-secondary);
            z-index: 1;
        }

        .detail-id { font-size: 0.75rem; color: var(--text-muted); font-family: monospace; margin-bottom: 0.5rem; }
        .detail-title { font-size: 1.125rem; font-weight: 600; line-height: 1.3; margin-bottom: 0.75rem; }
        .detail-badges { display: flex; gap: 0.5rem; flex-wrap: wrap; }
        .detail-badge { font-size: 0.7rem; padding: 0.2rem 0.5rem; border-radius: 4px; font-weight: 500; }

        .detail-close {
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            width: 32px; height: 32px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            flex-shrink: 0;
            margin-left: 1rem;
        }
        .detail-close:hover { background: var(--bg-primary); color: var(--text-primary); }

        .detail-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.75rem;
        }

        .btn {
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            border: 1px solid var(--border);
            transition: background 0.2s, border-color 0.2s;
        }

        .btn-edit {
            background: var(--bg-card);
            color: var(--text-primary);
        }
        .btn-edit:hover { background: var(--blue); border-color: var(--blue); }

        .btn-delete {
            background: var(--bg-card);
            color: var(--red);
            border-color: var(--red);
        }
        .btn-delete:hover { background: var(--red); color: white; }

        .btn-primary {
            background: var(--blue);
            color: white;
            border-color: var(--blue);
        }
        .btn-primary:hover { background: #2563eb; }

        .btn-cancel {
            background: var(--bg-card);
            color: var(--text-secondary);
        }
        .btn-cancel:hover { background: var(--bg-primary); }

        .modal-backdrop {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 300;
        }
        .modal-backdrop.open { display: flex; }

        .modal {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 1rem 1.25rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title { font-size: 1rem; font-weight: 600; }

        .modal-body { padding: 1.25rem; }

        .modal-footer {
            padding: 1rem 1.25rem;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
        }

        .form-group { margin-bottom: 1rem; }
        .form-group:last-child { margin-bottom: 0; }

        .form-label {
            display: block;
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .form-input, .form-textarea, .form-select {
            width: 100%;
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 0.625rem 0.75rem;
            border-radius: 6px;
            font-size: 0.875rem;
            font-family: inherit;
        }
        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: var(--blue);
        }

        .form-textarea { min-height: 100px; resize: vertical; }

        .confirm-text {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .confirm-task-title {
            font-weight: 600;
            color: var(--text-primary);
        }

        .detail-section { padding: 1rem 1.25rem; border-bottom: 1px solid var(--border); }
        .detail-section:last-child { border-bottom: none; }
        .detail-section-title {
            font-size: 0.7rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.75rem;
            font-weight: 600;
        }

        .detail-description { font-size: 0.875rem; line-height: 1.6; color: var(--text-primary); white-space: pre-wrap; }
        .detail-context { font-size: 0.8rem; line-height: 1.5; color: var(--text-secondary); background: var(--bg-card); padding: 0.75rem; border-radius: 6px; white-space: pre-wrap; }
        .detail-blockers { background: rgba(239,68,68,0.1); border: 1px solid var(--red); padding: 0.75rem; border-radius: 6px; color: var(--red); font-size: 0.875rem; line-height: 1.5; }
        .detail-handoff { background: rgba(59,130,246,0.1); border: 1px solid var(--blue); padding: 0.75rem; border-radius: 6px; color: var(--text-primary); font-size: 0.875rem; line-height: 1.5; }

        .detail-meta { display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.75rem; }
        .meta-item { background: var(--bg-card); padding: 0.625rem; border-radius: 4px; }
        .meta-label { font-size: 0.65rem; color: var(--text-muted); text-transform: uppercase; margin-bottom: 0.25rem; }
        .meta-value { font-size: 0.875rem; color: var(--text-primary); }

        .detail-activity { display: flex; flex-direction: column; gap: 0.75rem; }
        .activity-item { display: flex; gap: 0.75rem; font-size: 0.8rem; }
        .activity-icon { width: 24px; height: 24px; border-radius: 50%; background: var(--bg-card); display: flex; align-items: center; justify-content: center; flex-shrink: 0; font-size: 0.7rem; }
        .activity-icon.status { background: var(--blue); color: white; }
        .activity-icon.note { background: var(--purple); color: white; }
        .activity-content { flex: 1; min-width: 0; }
        .activity-text { color: var(--text-primary); margin-bottom: 0.25rem; }
        .activity-time { font-size: 0.7rem; color: var(--text-muted); }

        .empty-state { text-align: center; padding: 1rem; color: var(--text-muted); font-size: 0.8rem; font-style: italic; }

        .toast {
            position: fixed; bottom: 20px; left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--bg-card);
            border: 1px solid var(--border);
            padding: 0.75rem 1.25rem;
            border-radius: 6px;
            font-size: 0.875rem;
            color: var(--text-primary);
            opacity: 0;
            transition: transform 0.3s, opacity 0.3s;
            z-index: 300;
        }
        .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
    </style>
</head>
<body>
    <div id="app"><div class="no-data">Loading...</div></div>
    <div class="detail-backdrop" id="detailBackdrop"></div>
    <div class="detail-panel" id="detailPanel"></div>
    <div class="toast" id="toast"></div>

    <!-- Edit Modal -->
    <div class="modal-backdrop" id="editModal">
        <div class="modal">
            <div class="modal-header">
                <span class="modal-title">Edit Task</span>
                <button class="detail-close" onclick="closeEditModal()">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editTaskId">
                <div class="form-group">
                    <label class="form-label">Title</label>
                    <input type="text" class="form-input" id="editTitle">
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-textarea" id="editDescription"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Type</label>
                    <select class="form-select" id="editType">
                        <option value="feature">Feature</option>
                        <option value="bug">Bug</option>
                        <option value="chore">Chore</option>
                        <option value="spike">Spike</option>
                        <option value="test">Test</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Estimate (hours)</label>
                    <input type="number" class="form-input" id="editEstimate" min="0" step="0.5">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-cancel" onclick="closeEditModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveTask()">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal-backdrop" id="deleteModal">
        <div class="modal">
            <div class="modal-header">
                <span class="modal-title">Delete Task</span>
                <button class="detail-close" onclick="closeDeleteModal()">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="deleteTaskId">
                <p class="confirm-text">
                    Are you sure you want to delete this task?<br><br>
                    <span class="confirm-task-title" id="deleteTaskTitle"></span><br><br>
                    This action will archive the task. It can be restored via the CLI.
                </p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-cancel" onclick="closeDeleteModal()">Cancel</button>
                <button class="btn btn-delete" onclick="confirmDelete()">Delete Task</button>
            </div>
        </div>
    </div>
    <script>
        // All data comes from local SQLite (trusted source). esc() escapes HTML chars.
        const REFRESH_INTERVAL = 3000;
        const COLUMNS = [
            { id: 'todo', title: 'To Do', status: 'todo' },
            { id: 'in_progress', title: 'In Progress', status: 'in_progress' },
            { id: 'review', title: 'Review', status: 'review' },
            { id: 'done', title: 'Done', status: 'done' },
            { id: 'blocked', title: 'Blocked', status: 'blocked' },
        ];

        let data = window.KANBAN_DATA || {};
        let lastSync = data.synced_at;
        let filters = { epic: '', priority: '', type: '', story: '', groupBy: 'none', viewMode: 'columns' };
        let currentTaskId = null;

        function init() {
            document.getElementById('detailBackdrop').onclick = closeDetail;
            if (data.tasks && data.tasks.length) render();
            else renderNoData();
            setInterval(checkUpdates, REFRESH_INTERVAL);
        }

        async function checkUpdates() {
            try {
                const r = await fetch('kanban.html?_=' + Date.now());
                const t = await r.text();
                const m = t.match(/"synced_at":\s*"([^"]+)"/);
                if (m && m[1] !== lastSync) {
                    // Extract new data without full page reload to preserve UI state
                    const dataMatch = t.match(/window\.KANBAN_DATA\s*=\s*(\{[\s\S]*?\});\s*<\/script>/);
                    if (dataMatch) {
                        try {
                            const newData = JSON.parse(dataMatch[1]);
                            data = newData;
                            lastSync = data.synced_at;
                            render();
                            // Re-render detail panel if open with updated task data
                            if (currentTaskId) {
                                const task = (data.tasks||[]).find(t => t.id === currentTaskId);
                                if (task) renderDetailPanel(task);
                            }
                        } catch(parseErr) {
                            // Fall back to reload if parsing fails
                            location.reload();
                        }
                    } else {
                        location.reload();
                    }
                }
            } catch(e) {}
        }

        function esc(s) {
            if (s == null) return '';
            return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
        }

        function getStoryCompletion(storyId) {
            if (!storyId) return null;
            const storyTasks = (data.tasks||[]).filter(t => t.story_id === storyId);
            if (storyTasks.length === 0) return null;
            const doneTasks = storyTasks.filter(t => t.status === 'done').length;
            return { done: doneTasks, total: storyTasks.length };
        }

        function getEpicCompletion(epicId) {
            if (!epicId) return null;
            const epicStoryIds = new Set((data.stories||[]).filter(s => s.epic_id === epicId).map(s => s.id));
            const epicTasks = (data.tasks||[]).filter(t => epicStoryIds.has(t.story_id));
            if (epicTasks.length === 0) return null;
            const doneTasks = epicTasks.filter(t => t.status === 'done').length;
            return { done: doneTasks, total: epicTasks.length };
        }

        function render() {
            const s = data.stats || {};
            const total = s.total_tasks || 1;
            const app = document.getElementById('app');
            app.textContent = '';

            const header = document.createElement('header');
            header.className = 'header';
            header.innerHTML = '<div style="display:flex;align-items:center;gap:1rem"><h1>' + esc(data.projects && data.projects[0] ? data.projects[0].name : 'Ohno') + '</h1><div class="sync-status"><span class="sync-dot"></span><span>' + new Date(data.synced_at).toLocaleTimeString() + '</span></div></div><div class="stats"><div><span class="stat-value">' + s.done_tasks + '/' + s.total_tasks + '</span><span class="stat-label">tasks</span></div><div><span class="stat-value">' + s.completion_percent + '%</span><span class="stat-label">done</span></div><div><span class="stat-value">' + s.in_progress_tasks + '</span><span class="stat-label">active</span></div><div><span class="stat-value">' + s.blocked_tasks + '</span><span class="stat-label">blocked</span></div></div>';
            app.appendChild(header);

            const progressBar = document.createElement('div');
            progressBar.className = 'progress-bar-container';
            progressBar.innerHTML = '<div class="progress-bar"><div class="progress-done" style="width:' + (s.done_tasks/total*100) + '%"></div><div class="progress-review" style="width:' + (s.review_tasks/total*100) + '%"></div><div class="progress-in-progress" style="width:' + (s.in_progress_tasks/total*100) + '%"></div><div class="progress-blocked" style="width:' + (s.blocked_tasks/total*100) + '%"></div></div>';
            app.appendChild(progressBar);

            const filtersEl = document.createElement('div');
            filtersEl.className = 'filters';
            let filterHtml = '<div class="filter-group"><span class="filter-label">Epic</span><select class="filter-select" id="filterEpic"><option value="">All</option>';
            (data.epics||[]).forEach(e => { filterHtml += '<option value="' + esc(e.id) + '">' + esc(e.title) + '</option>'; });
            filterHtml += '</select></div><div class="filter-group"><span class="filter-label">Story</span><select class="filter-select" id="filterStory"><option value="">All</option>';
            (data.stories||[]).forEach(s => { filterHtml += '<option value="' + esc(s.id) + '">' + esc(s.title) + '</option>'; });
            filterHtml += '</select></div><div class="filter-group"><span class="filter-label">Priority</span><select class="filter-select" id="filterPriority"><option value="">All</option><option value="P0">P0</option><option value="P1">P1</option><option value="P2">P2</option></select></div>';
            filterHtml += '<div class="filter-group"><span class="filter-label">Type</span><select class="filter-select" id="filterType"><option value="">All</option><option value="feature">Feature</option><option value="bug">Bug</option><option value="chore">Chore</option><option value="spike">Spike</option><option value="test">Test</option></select></div>';
            filterHtml += '<div class="filter-group"><span class="filter-label">Group By</span><select class="filter-select" id="filterGroupBy"><option value="none">None</option><option value="epic">Epic</option><option value="story">Story</option></select></div>';
            filterHtml += '<div class="filter-group"><span class="filter-label">View</span><select class="filter-select" id="filterViewMode"><option value="columns">Columns</option><option value="hierarchy">Hierarchy</option></select></div>';
            filtersEl.innerHTML = filterHtml;
            app.appendChild(filtersEl);
            document.getElementById('filterEpic').value = filters.epic;
            document.getElementById('filterStory').value = filters.story;
            document.getElementById('filterPriority').value = filters.priority;
            document.getElementById('filterType').value = filters.type;
            document.getElementById('filterGroupBy').value = filters.groupBy;
            document.getElementById('filterViewMode').value = filters.viewMode;
            document.getElementById('filterEpic').onchange = function() { setFilter('epic', this.value); };
            document.getElementById('filterStory').onchange = function() { setFilter('story', this.value); };
            document.getElementById('filterPriority').onchange = function() { setFilter('priority', this.value); };
            document.getElementById('filterType').onchange = function() { setFilter('type', this.value); };
            document.getElementById('filterGroupBy').onchange = function() { setFilter('groupBy', this.value); };
            document.getElementById('filterViewMode').onchange = function() { setFilter('viewMode', this.value); };

            if (filters.viewMode === 'hierarchy') {
                const hierarchyEl = document.createElement('div');
                hierarchyEl.innerHTML = renderHierarchyView(getFilteredTasks());
                app.appendChild(hierarchyEl);

                // Attach click handlers for task detail
                hierarchyEl.querySelectorAll('.hierarchy-task').forEach(el => {
                    el.onclick = function() { openDetail(this.dataset.id); };
                });
            } else {
                const board = document.createElement('div');
                board.className = 'board';
                COLUMNS.forEach(col => {
                    const colEl = document.createElement('div');
                    colEl.className = 'column column-' + col.id;
                    const tasks = getFilteredTasks().filter(t => t.status === col.status);
                    let colHtml = '<div class="column-header"><span class="column-title">' + esc(col.title) + '</span><span class="column-count">' + tasks.length + '</span></div><div class="column-cards">';
                    colHtml += renderGroupedCards(tasks, filters.groupBy);
                    colHtml += '</div>';
                    colEl.innerHTML = colHtml;
                    board.appendChild(colEl);
                });
                app.appendChild(board);

                board.querySelectorAll('.card').forEach(card => {
                    card.onclick = function() { openDetail(this.dataset.id); };
                });
            }
        }

        function renderCard(task) {
            let html = '<div class="card" data-id="' + esc(task.id) + '">';

            // Orphan indicator for tasks without story assignment
            if (!task.story_id) {
                html += '<div class="card-orphan">⚠ No story</div>';
            }

            // Breadcrumb at top showing Epic > Story path
            if (task.epic_id && task.epic_title) {
                html += '<div class="card-breadcrumb">';
                html += esc(task.epic_title);
                if (task.epic_priority) {
                    html += ' <span class="card-priority priority-' + esc(task.epic_priority) + '">' + esc(task.epic_priority) + '</span>';
                }
                if (task.story_id && task.story_title) {
                    html += ' / ' + esc(task.story_title);
                }
                html += ' →</div>';
            }

            html += '<div class="card-header"><span class="card-id">' + esc(task.id) + '</span>';
            if (task.epic_priority) html += '<span class="card-priority priority-' + esc(task.epic_priority) + '">' + esc(task.epic_priority) + '</span>';
            html += '</div><div class="card-title">' + esc(task.title) + '</div>';
            const deps = (data.task_dependencies||[]).filter(d => d.task_id === task.id);
            const blockedByDeps = deps.some(d => {
                const depTask = (data.tasks||[]).find(t => t.id === d.depends_on_task_id);
                return depTask && depTask.status !== 'done';
            });
            if (blockedByDeps && task.status === 'todo') {
                html += '<div style="font-size:0.65rem;color:var(--orange);margin-bottom:0.25rem">&#9203; Waiting on deps</div>';
            }
            html += '<div class="card-meta">' + (task.task_type ? '<span class="card-type">' + esc(task.task_type) + '</span>' : '<span></span>');
            let metaRight = '';
            if (task.progress_percent > 0) metaRight += '<span style="color:var(--green)">' + task.progress_percent + '%</span> ';
            if (task.estimate_hours) metaRight += '<span>' + task.estimate_hours + 'h</span>';
            html += metaRight || '<span></span>';
            html += '</div>';
            // Story with completion badge
            if (task.story_id && task.story_title) {
                const storyComp = getStoryCompletion(task.story_id);
                html += '<div class="card-hierarchy"><span class="card-hierarchy-label">Story:</span> ' + esc(task.story_title);
                if (storyComp) html += ' <span class="card-completion">' + storyComp.done + '/' + storyComp.total + '</span>';
                html += '</div>';
            }
            // Epic with completion badge
            if (task.epic_id && task.epic_title) {
                const epicComp = getEpicCompletion(task.epic_id);
                html += '<div class="card-hierarchy"><span class="card-hierarchy-label">Epic:</span> ' + esc(task.epic_title);
                if (epicComp) html += ' <span class="card-completion">' + epicComp.done + '/' + epicComp.total + '</span>';
                html += '</div>';
            }
            html += '</div>';
            return html;
        }

        function getFilteredTasks() {
            let tasks = data.tasks || [];
            if (filters.epic) {
                const storyIds = new Set((data.stories||[]).filter(s => s.epic_id === filters.epic).map(s => s.id));
                tasks = tasks.filter(t => storyIds.has(t.story_id));
            }
            if (filters.story) tasks = tasks.filter(t => t.story_id === filters.story);
            if (filters.priority) tasks = tasks.filter(t => t.epic_priority === filters.priority);
            if (filters.type) tasks = tasks.filter(t => t.task_type === filters.type);
            return tasks;
        }

        function renderGroupedCards(tasks, groupBy) {
            if (groupBy === 'none' || !tasks.length) {
                let html = '';
                tasks.forEach(task => { html += renderCard(task); });
                return html || '<div class="empty">No tasks</div>';
            }

            // Group tasks
            const groups = {};
            const orphanKey = groupBy === 'epic' ? '(No Epic)' : '(No Story)';

            tasks.forEach(task => {
                let key, title;
                if (groupBy === 'epic') {
                    key = task.epic_id || orphanKey;
                    title = task.epic_title || orphanKey;
                } else {
                    key = task.story_id || orphanKey;
                    title = task.story_title || orphanKey;
                }
                if (!groups[key]) groups[key] = { title, tasks: [], isOrphan: !task[groupBy + '_id'] };
                groups[key].tasks.push(task);
            });

            // Sort: alphabetical, orphans last
            const sortedKeys = Object.keys(groups).sort((a, b) => {
                if (groups[a].isOrphan) return 1;
                if (groups[b].isOrphan) return -1;
                return groups[a].title.localeCompare(groups[b].title);
            });

            let html = '';
            sortedKeys.forEach(key => {
                const group = groups[key];
                const completion = groupBy === 'epic'
                    ? getEpicCompletion(key === orphanKey ? null : key)
                    : getStoryCompletion(key === orphanKey ? null : key);

                html += '<div class="group-header"><span class="group-name">' + esc(group.title);
                if (completion) html += ' <span class="card-completion">' + completion.done + '/' + completion.total + '</span>';
                html += '</span></div>';
                group.tasks.forEach(task => { html += renderCard(task); });
            });

            return html || '<div class="empty">No tasks</div>';
        }

        function renderHierarchyView(tasks) {
            if (!tasks.length) return '<div class="hierarchy-view"><div class="empty">No tasks match filters</div></div>';

            // Build hierarchy: Epic > Story > Task
            const epics = {};
            const orphanTasks = [];

            tasks.forEach(task => {
                if (!task.epic_id) {
                    orphanTasks.push(task);
                    return;
                }

                if (!epics[task.epic_id]) {
                    epics[task.epic_id] = {
                        id: task.epic_id,
                        title: task.epic_title,
                        priority: task.epic_priority,
                        stories: {}
                    };
                }

                const storyKey = task.story_id || '_direct';
                if (!epics[task.epic_id].stories[storyKey]) {
                    epics[task.epic_id].stories[storyKey] = {
                        id: task.story_id,
                        title: task.story_title || '(Direct tasks)',
                        tasks: []
                    };
                }
                epics[task.epic_id].stories[storyKey].tasks.push(task);
            });

            let html = '<div class="hierarchy-view">';

            // Render epics sorted alphabetically
            const epicIds = Object.keys(epics).sort((a, b) =>
                (epics[a].title || '').localeCompare(epics[b].title || '')
            );

            epicIds.forEach(epicId => {
                const epic = epics[epicId];
                const epicComp = getEpicCompletion(epicId);

                html += '<div class="epic-section" data-section-id="epic-' + esc(epicId) + '">';
                html += '<div class="epic-header" onclick="toggleSection(\'epic-' + esc(epicId) + '\')">';
                html += '<span class="collapse-icon">▼</span>';
                html += '<span class="epic-title">' + esc(epic.title);
                if (epic.priority) html += ' <span class="card-priority priority-' + esc(epic.priority) + '">' + esc(epic.priority) + '</span>';
                html += '</span>';
                if (epicComp) html += '<span class="hierarchy-badge">' + epicComp.done + '/' + epicComp.total + ' done</span>';
                html += '</div>';
                html += '<div class="epic-content">';

                // Render stories sorted alphabetically
                const storyKeys = Object.keys(epic.stories).sort((a, b) => {
                    if (a === '_direct') return 1;
                    if (b === '_direct') return -1;
                    return (epic.stories[a].title || '').localeCompare(epic.stories[b].title || '');
                });

                storyKeys.forEach(storyKey => {
                    const story = epic.stories[storyKey];
                    const storyComp = story.id ? getStoryCompletion(story.id) : null;

                    html += '<div class="story-section" data-section-id="story-' + esc(story.id || storyKey) + '">';
                    html += '<div class="story-header" onclick="toggleSection(\'story-' + esc(story.id || storyKey) + '\')">';
                    html += '<span class="collapse-icon">▼</span>';
                    html += '<span class="story-title">' + esc(story.title) + '</span>';
                    if (storyComp) html += '<span class="hierarchy-badge">' + storyComp.done + '/' + storyComp.total + ' done</span>';
                    html += '</div>';
                    html += '<div class="story-content">';

                    story.tasks.forEach(task => {
                        html += renderHierarchyTask(task);
                    });

                    html += '</div></div>';
                });

                html += '</div></div>';
            });

            // Render orphan tasks
            if (orphanTasks.length) {
                html += '<div class="orphan-section" data-section-id="orphan">';
                html += '<div class="orphan-header" onclick="toggleSection(\'orphan\')">';
                html += '<span class="collapse-icon">▼</span>';
                html += '<span class="epic-title">[No Epic]</span>';
                html += '<span class="hierarchy-badge">' + orphanTasks.filter(t => t.status === 'done').length + '/' + orphanTasks.length + ' done</span>';
                html += '</div>';
                html += '<div class="orphan-content">';
                orphanTasks.forEach(task => {
                    html += renderHierarchyTask(task);
                });
                html += '</div></div>';
            }

            html += '</div>';
            return html;
        }

        function renderHierarchyTask(task) {
            let html = '<div class="hierarchy-task" data-id="' + esc(task.id) + '">';
            html += '<span class="task-id-link">' + esc(task.id) + '</span>';
            html += '<span class="task-title-text">' + esc(task.title) + '</span>';
            html += '<span class="status-badge status-' + esc(task.status) + '">' + esc(task.status) + '</span>';
            html += '</div>';
            return html;
        }

        function setFilter(key, val) { filters[key] = val; render(); }

        function toggleSection(sectionId) {
            const section = document.querySelector('[data-section-id="' + sectionId + '"]');
            if (section) {
                section.classList.toggle('collapsed');
                const icon = section.querySelector('.collapse-icon');
                if (icon) icon.textContent = section.classList.contains('collapsed') ? '▶' : '▼';
            }
        }
        window.toggleSection = toggleSection;

        function renderNoData() {
            const app = document.getElementById('app');
            app.innerHTML = '<header class="header"><h1>Ohno</h1></header><div class="no-data"><h2 style="margin-bottom:1rem">No Data</h2><p>Run <code>ohno init</code> and create some tasks</p></div>';
        }

        function openDetail(taskId) {
            currentTaskId = taskId;
            const task = (data.tasks||[]).find(t => t.id === taskId);
            if (!task) return;
            renderDetailPanel(task);
            document.getElementById('detailPanel').classList.add('open');
            document.getElementById('detailBackdrop').classList.add('open');
            document.body.style.overflow = 'hidden';
        }

        function closeDetail() {
            document.getElementById('detailPanel').classList.remove('open');
            document.getElementById('detailBackdrop').classList.remove('open');
            document.body.style.overflow = '';
            currentTaskId = null;
        }

        function renderDetailPanel(task) {
            const panel = document.getElementById('detailPanel');
            const activity = (data.task_activity||[]).filter(a => a.task_id === task.id).slice(0, 10);
            const deps = (data.task_dependencies||[]).filter(d => d.task_id === task.id);

            let html = '<div class="detail-header"><div style="flex:1"><div class="detail-id">' + esc(task.id) + '</div><div class="detail-title">' + esc(task.title) + '</div><div class="detail-badges">';
            const statusColors = {todo:'var(--text-muted)',in_progress:'var(--blue)',review:'var(--purple)',done:'var(--green)',blocked:'var(--red)'};
            html += '<span class="detail-badge" style="background:' + (statusColors[task.status]||'var(--text-muted)') + ';color:white">' + esc(task.status) + '</span>';
            if (task.epic_priority) {
                const priColors = {P0:'var(--red)',P1:'var(--orange)',P2:'var(--yellow)',P3:'var(--text-muted)'};
                html += '<span class="detail-badge" style="background:' + (priColors[task.epic_priority]||'var(--text-muted)') + ';color:white">' + esc(task.epic_priority) + '</span>';
            }
            if (task.task_type) html += '<span class="detail-badge" style="background:var(--bg-card)">' + esc(task.task_type) + '</span>';
            html += '</div><div class="detail-actions"><button class="btn btn-edit" onclick="openEditModal(\'' + esc(task.id) + '\')">Edit</button><button class="btn btn-delete" onclick="openDeleteModal(\'' + esc(task.id) + '\')">Delete</button></div></div><button class="detail-close" id="closeBtn">&times;</button></div>';

            if (task.blockers) html += '<div class="detail-section"><div class="detail-section-title">Blockers</div><div class="detail-blockers">' + esc(task.blockers) + '</div></div>';
            if (task.description) html += '<div class="detail-section"><div class="detail-section-title">Description</div><div class="detail-description">' + esc(task.description) + '</div></div>';
            if (task.context_summary) html += '<div class="detail-section"><div class="detail-section-title">Context</div><div class="detail-context">' + esc(task.context_summary) + '</div></div>';
            if (task.handoff_notes) html += '<div class="detail-section"><div class="detail-section-title">Handoff Notes</div><div class="detail-handoff">' + esc(task.handoff_notes) + '</div></div>';

            if (deps.length > 0) {
                html += '<div class="detail-section"><div class="detail-section-title">Dependencies</div><div>';
                deps.forEach(d => {
                    html += '<div style="padding:0.5rem;background:var(--bg-card);border-radius:4px;margin-bottom:0.5rem;font-size:0.8rem" class="dep-link" data-dep-id="' + esc(d.depends_on_task_id) + '"><span style="color:var(--purple);font-family:monospace;cursor:pointer">' + esc(d.depends_on_task_id) + '</span> <span style="color:var(--text-muted);font-size:0.7rem">(' + esc(d.depends_on_status||'unknown') + ')</span></div>';
                });
                html += '</div></div>';
            }

            html += '<div class="detail-section"><div class="detail-section-title">Activity</div>';
            if (activity.length > 0) {
                html += '<div class="detail-activity">';
                activity.forEach(a => {
                    html += '<div class="activity-item"><div class="activity-icon ' + (a.activity_type === 'status_change' ? 'status' : 'note') + '">' + (a.activity_type === 'status_change' ? '→' : '📝') + '</div><div class="activity-content"><div class="activity-text">' + esc(a.description||a.activity_type) + '</div><div class="activity-time">' + formatTime(a.created_at) + '</div></div></div>';
                });
                html += '</div>';
            } else {
                html += '<div class="empty-state">No activity</div>';
            }
            html += '</div>';

            html += '<div class="detail-section"><div class="detail-section-title">Details</div><div class="detail-meta">';
            if (task.epic_title) html += '<div class="meta-item"><div class="meta-label">Epic</div><div class="meta-value">' + esc(task.epic_title) + '</div></div>';
            if (task.story_title) html += '<div class="meta-item"><div class="meta-label">Story</div><div class="meta-value">' + esc(task.story_title) + '</div></div>';
            if (task.estimate_hours) html += '<div class="meta-item"><div class="meta-label">Estimate</div><div class="meta-value">' + task.estimate_hours + 'h</div></div>';
            if (task.created_at) html += '<div class="meta-item"><div class="meta-label">Created</div><div class="meta-value">' + formatTime(task.created_at) + '</div></div>';
            html += '</div></div>';

            panel.innerHTML = html;
            document.getElementById('closeBtn').onclick = closeDetail;
            panel.querySelectorAll('.dep-link').forEach(el => {
                el.onclick = function() { openDetail(this.dataset.depId); };
            });
        }

        function formatTime(isoStr) {
            if (!isoStr) return '';
            try {
                const d = new Date(isoStr);
                const diff = Date.now() - d.getTime();
                if (diff < 60000) return 'Just now';
                if (diff < 3600000) return Math.floor(diff/60000) + 'm ago';
                if (diff < 86400000) return Math.floor(diff/3600000) + 'h ago';
                return d.toLocaleDateString();
            } catch(e) { return isoStr; }
        }

        function showToast(message, isError = false) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.style.borderColor = isError ? 'var(--red)' : 'var(--green)';
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        function openEditModal(taskId) {
            const task = (data.tasks||[]).find(t => t.id === taskId);
            if (!task) return;

            document.getElementById('editTaskId').value = taskId;
            document.getElementById('editTitle').value = task.title || '';
            document.getElementById('editDescription').value = task.description || '';
            document.getElementById('editType').value = task.task_type || 'feature';
            document.getElementById('editEstimate').value = task.estimate_hours || '';

            document.getElementById('editModal').classList.add('open');
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.remove('open');
        }

        async function saveTask() {
            const taskId = document.getElementById('editTaskId').value;
            const title = document.getElementById('editTitle').value.trim();
            const description = document.getElementById('editDescription').value.trim();
            const task_type = document.getElementById('editType').value;
            const estimate_hours = parseFloat(document.getElementById('editEstimate').value) || null;

            if (!title) {
                showToast('Title is required', true);
                return;
            }

            try {
                const res = await fetch('/api/tasks/' + encodeURIComponent(taskId), {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ title, description, task_type, estimate_hours })
                });

                const result = await res.json();

                if (res.ok && result.success) {
                    showToast('Task updated successfully');
                    closeEditModal();
                    // Update will happen via file watcher, but update local data for immediate feedback
                    const task = (data.tasks||[]).find(t => t.id === taskId);
                    if (task) {
                        task.title = title;
                        task.description = description;
                        task.task_type = task_type;
                        task.estimate_hours = estimate_hours;
                        render();
                        if (currentTaskId === taskId) renderDetailPanel(task);
                    }
                } else {
                    showToast(result.error || 'Failed to update task', true);
                }
            } catch (e) {
                showToast('Failed to update task: ' + e.message, true);
            }
        }

        function openDeleteModal(taskId) {
            const task = (data.tasks||[]).find(t => t.id === taskId);
            if (!task) return;

            document.getElementById('deleteTaskId').value = taskId;
            document.getElementById('deleteTaskTitle').textContent = task.title;

            document.getElementById('deleteModal').classList.add('open');
        }

        function closeDeleteModal() {
            document.getElementById('deleteModal').classList.remove('open');
        }

        async function confirmDelete() {
            const taskId = document.getElementById('deleteTaskId').value;

            try {
                const res = await fetch('/api/tasks/' + encodeURIComponent(taskId), {
                    method: 'DELETE'
                });

                const result = await res.json();

                if (res.ok && result.success) {
                    showToast('Task deleted successfully');
                    closeDeleteModal();
                    closeDetail();
                    // Remove from local data for immediate feedback
                    data.tasks = (data.tasks||[]).filter(t => t.id !== taskId);
                    render();
                } else {
                    showToast(result.error || 'Failed to delete task', true);
                }
            } catch (e) {
                showToast('Failed to delete task: ' + e.message, true);
            }
        }

        document.addEventListener('keydown', e => {
            if (e.key === 'Escape') {
                if (document.getElementById('editModal').classList.contains('open')) {
                    closeEditModal();
                } else if (document.getElementById('deleteModal').classList.contains('open')) {
                    closeDeleteModal();
                } else if (currentTaskId) {
                    closeDetail();
                }
            }
        });
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>